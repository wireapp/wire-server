# Server and team feature settings

Features can be enabled or disabled on a team level or server wide. Here we will only cover the server wide configuration.

When a feature's lock status is `unlocked` it means that its settings can be overridden on a team level by team admins. This can be done via the team management app or via the team feature API and is not covered here.

## 2nd factor password challenge

By default Wire enforces a 2nd factor authentication for certain user operations like e.g. activating an account, changing email or password, or deleting an account.

If the `sndFactorPasswordChallenge` feature is enabled, a 6 digit verification code will be send per email to authenticate for additional user operations like e.g. for login, adding a new client, generating SCIM tokens, or deleting a team.

After 3 attempts, the key is invalidated, and requests for generating new verification codes are rate limited. The default delay between two consecutive requests is 5 minutes.

Usually the default is what you want. If you explicitly want to enable additional password challenges, add the following to your Helm overrides in `values/wire-server/values.yaml`:

```yaml
galley:
  # ...
  config:
    # ...
    settings:
      # ...
      featureFlags:
        # ...
        sndFactorPasswordChallenge:
          defaults:
            status: enabled
            lockStatus: locked
```

Note that the lock status is required but has no effect, as it is currently not supported for team admins to enable or disable `sndFactorPasswordChallenge`. We recommend to set the lock status to `locked`.

Currently the 2nd factor password challenge if enabled has no effect for SSO users.

As there is currently no feasible way for bots to use the 2nd factor password challenge, bots and the service API are blocked when this feature is enabled.

## Rate limiting of code generation requests

The default delay between code generation requests is 5 minutes. This setting can be overridden in the Helm charts:

```yaml
brig:
  # ...
  config:
    # ...
    optSettings:
      # ...
      set2FACodeGenerationDelaySecs: 300 # 5 minutes
```

## Guest links

The guest link feature is the ability for a Wire users to join a group conversation by tapping on a unique link generated by an admin of that group.

The feature is enabled and unlocked by default and can be disabled on a per-team (via team management) basis or disabled and optionally locked for the entire backend (via Helm overrides). If the feature is locked, it cannot be enabled by team admins via team management.

To change the configuration for the entire server, add the following to your Helm overrides in `values/wire-server/values.yaml`:

```yaml
galley:
  # ...
  config:
    # ...
    settings:
      # ...
      featureFlags:
        # ...
        conversationGuestLinks:
          defaults:
            status: disabled
            lockStatus: locked
```

## TTL for nonces

Nonces that can be retrieved e.g. by calling `HEAD /nonce/clients` have a default time-to-live of 5 minutes. To change this setting add the following to your Helm overrides in `values/wire-server/values.yaml`:

```yaml
brig:
  # ...
  config:
    # ...
    optSettings:
      # ...
      setNonceTtlSecs: 360 # 6 minutes
```

## MLS End-to-End Identity

The MLS end-to-end identity team feature adds an extra level of security and practicability. If turned on, automatic device authentication ensures that team members know they are communicating with people using authenticated devices. Team members get a certificate on all their devices.

When a client first tries to fetch or renew a certificate, they may need to login to an identity provider (IdP) depending on their IdP domain authentication policy. The user may have a grace period during which they can “snooze” this login. The duration of this grace period (in seconds) is set in the `verificationDuration` parameter, which is enforced separately by each client. After the grace period has expired, the client will not allow the user to use the application until they have logged to refresh the certificate. The default value is 1 day (86400s).

The client enrolls using the Automatic Certificate Management Environment (ACME) protocol [RFC 8555](https://www.rfc-editor.org/rfc/rfc8555.html). The `acmeDiscoveryUrl` parameter must be set to the HTTPS URL of the ACME server discovery endpoint for this team. It is of the form "https://acme.{backendDomain}/acme/{provisionerName}/discovery". For example: `https://acme.example.com/acme/provisioner1/discovery`.

```yaml
galley:
  # ...
  config:
    # ...
    settings:
      # ...
      featureFlags:
        # ...
        mlsE2EId:
          defaults:
            status: disabled
            config:
              verificationExpiration: 86400
              acmeDiscoveryUrl: null
            lockStatus: unlocked
```

## URL configuration.

URLs pointing to things such as the privary policy and support are displayed at various places in the clients.

These URLs are configured and can be changed in the backend, by modifying the following configuration options:

In `values.yaml` ([example](https://github.com/wireapp/wire-server-deploy/blob/master/values/wire-server/prod-values.example.yaml#L250)):

```yaml
webapp:
  # ...
  envVars:
    # ...
    URL_ACCOUNT_BASE: "https://account.example.com"
    #URL_MOBILE_BASE: "https://wire-pwa-staging.zinfra.io" # TODO: is this needed?
    URL_PRIVACY_POLICY: "https://www.example.com/terms-conditions"
    URL_SUPPORT_BASE: "https://www.example.com/support"
    URL_TEAMS_BASE: "https://teams.example.com"
    URL_TEAMS_CREATE: "https://teams.example.com"
    URL_TERMS_OF_USE_PERSONAL: "https://www.example.com/terms-conditions"
    URL_TERMS_OF_USE_TEAMS: "https://www.example.com/terms-conditions"
    URL_WEBSITE_BASE: "https://www.example.com"
```

Separately, you should also edit the `wire-team-settings` file [`.env.defaults`](https://github.com/wireapp/wire-web-config-wire/blob/master/wire-team-settings/.env.defaults#L111) :

```
# Specifies the user facing domain of the app, e.g. https://teams.wire.com
APP_BASE="https://teams.wire.com"

# [...]

# Sets the host URL for the account service (password reset, account deletion, etc.), e.g. https://account.wire.com
URL_ACCOUNT_BASE="https://account.wire.com"

URL_ACCOUNT_DELETE_SURVEY="https://wireapp.typeform.com/to/quYBS7"

URL_CREATE_BOT="https://github.com/wireapp/lithium"

URL_DOWNLOAD="https://wire.com/download/"

URL_GET_WIRE_BASE="https://get.wire.com"

URL_LEGAL="https://wire.com/legal/"

URL_PRIVACY_POLICY="https://wire.com/legal/"

URL_SALES="https://wire.com/en/contact-sales"

# Sets the URL for pricing information, e.g. https://wire.com/pricing
URL_PRICING="https://wire.com/pricing"

URL_SUPPORT_GETTING_STARTED="https://support.wire.com/hc/categories/360000242937?section=start"

URL_SUPPORT_E2EID_INFO_URL="https://support.wire.com/hc/articles/9211300150685"

URL_SUPPORT_LEGAL_HOLD="https://support.wire.com/hc/articles/360002018278"

URL_SUPPORT_NEW_DE="https://support.wire.com/hc/de/requests/new"

URL_SUPPORT_NEW_EN="https://support.wire.com/hc/en-us/requests/new"

URL_SUPPORT_NEW_FR="https://support.wire.com/hc/fr/requests/new"

URL_SUPPORT_NEW="https://support.wire.com/hc/requests/new"

URL_SUPPORT_ROLES="https://support.wire.com/hc/articles/115003862509"

URL_SUPPORT_SSO_CONFIGURATION="https://support.wire.com/hc/requests/new"

URL_SUPPORT_SSO_LOGIN_DESKTOP="https://support.wire.com/hc/articles/360000954617"

URL_SUPPORT_SSO_LOGIN_MOBILE="https://support.wire.com/hc/articles/360000955017"

URL_SUPPORT_SCIM="https://docs.wire.com/how-to/scim/index.html"

# Sets the URL for the teams terms of use
URL_TERMS_OF_USE_TEAMS="https://wire.com/legal/terms/teams"

# Sets the host URL for the webapp, e.g. https://app.wire.com
URL_WEBAPP_BASE="https://app.wire.com"

# Sets the host URL for the website, e.g. https://wire.com
URL_WEBSITE_BASE="https://wire.com"
```

The values are stored inside of the `team-settings` pod in your wire kubernetes installation.

To edit the variables, first you need to find the precise name of the `team-settings` pod.

To get all pods:

```
d kubectl get pods -owide
```

To get just the `team-settings` pod:

```
d kubectl get pods -l app=team-settings
```

In this example we get:

```
demo@wiab-22:~/wire-server-deploy$ d kubectl get pods -l app=team-settings 
NAME                             READY   STATUS    RESTARTS   AGE
team-settings-6db5b6cb95-dc5s7   1/1     Running   0          18d
```

So here our `team-settings` pod name is `team-settings-6db5b6cb95-dc5s7`

Next we log into the pod itself:

```
d kubectl exec -it team-settings-6db5b6cb95-dc5s7 -- /bin/bash
```

This gives us a prompt into the pod. We can then see the file we want to edit with `ls -lh .env.defaults` :

```
team-settings-6db5b6cb95-dc5s7:/$ ls -lh .env.defaults 
-rw-r--r--    1 root     root        6.8K Oct 19 08:39 .env.defaults
```

Now that we know where the file is, we can edit it using `vi`:

```
vi .env.defaults
```

Now that you are inside the file, you can not immediately edit the file as you could with something like `nano`.

In vi, there are different modes for editing and other tasks.

So first, you must enter edit mode by typing `i` on your keyboard.

Now that you are in edit mode, you can navigate as usual using your keyboard arrows and keys to move and edit the values.

Once you have done your changes, you can save them to the file.

You do this by hitting the `Escape` key, followed by `:wq` followed by `Enter`.

This will save the file and exit `vi`.

To finish, you can make sure the saved contents of the file are as you expect using `vi` or type:

```
cat .env.defaults
```

You're done, your values are changed, exit the pod by entering:

```
exit
```



 




