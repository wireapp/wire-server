<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Creating and populating conversations &mdash; Wire 0.0.4 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/wire.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3. Maintaining ElasticSearch" href="elastic-search.html" />
    <link rel="prev" title="1. Config Options" href="config-options.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href="../../index.html">
        <img src="../../_static/Wire_logo.svg" class="logo" alt="Logo"/>
    </a>

    <!--
            <div class="version">
                0.0.4
            </div> -->
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../security-responses/index.html">Security responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/administrate/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../understand/index.html">Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developers Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../developer/index.html">Developer</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="config-options.html">1. Config Options</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2. Creating and populating conversations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">2.1. Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contact-requests">2.2. Contact requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conversations">2.3. Conversations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-topics">2.4. Advanced topics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="elastic-search.html">3. Maintaining ElasticSearch</a></li>
<li class="toctree-l3"><a class="reference internal" href="elasticsearch-migration-2021-02-16.html">4. ElasticSearch migration instructions for release 2021-02-16</a></li>
<li class="toctree-l3"><a class="reference internal" href="make-docker-and-qemu.html">5. Make docker and QEMU</a></li>
<li class="toctree-l3"><a class="reference internal" href="oauth.html">6. OAuth</a></li>
<li class="toctree-l3"><a class="reference internal" href="provisioning/scim-token.html">7. SCIM tokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="spar-braindump.html">8. Spar braindump</a></li>
<li class="toctree-l3"><a class="reference internal" href="team/legalhold.html">9. Legal hold</a></li>
<li class="toctree-l3"><a class="reference internal" href="user/activation.html">10. User Activation</a></li>
<li class="toctree-l3"><a class="reference internal" href="user/connection.html">11. Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="user/connection.html#connection-backend-internals">12. Connection backend internals</a></li>
<li class="toctree-l3"><a class="reference internal" href="user/registration.html">13. User Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="user/rich-info.html">14. User Rich info</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Wire</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Notes for developers</a></li>
          <li class="breadcrumb-item"><a href="index.html">Reference</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>Creating and populating conversations</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/wireapp/wire-server/blob/develop/docs/src/developer/reference/conversation.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-and-populating-conversations">
<h1><span class="section-number">2. </span>Creating and populating conversations<a class="headerlink" href="#creating-and-populating-conversations" title="Permalink to this heading"></a></h1>
<p>Reference: {#RefCreateAndPopulateConvs}</p>
<p><em>Author: Matthias Fischmann</em></p>
<hr class="docutils" />
<p>This will walk you through creating and populating a conversation
using <a class="reference external" href="https://curl.haxx.se/">curl</a> commands and the credentials of an
ordinary user (member role).</p>
<p>If you have a system for identity management like a SAML IdP, you may
be able to use that as a source of user and group information, and
write a script or a program based on this document to keep your wire
conversations in sync with your groups.</p>
<p>Sidenote: in the future we may implement groups in our <a class="reference external" href="http://www.simplecloud.info/">SCIM
API</a> to handle conversations.  For the
time being, we hope you consider the approach explained here a decent
work-around.</p>
<section id="prerequisites">
<h2><span class="section-number">2.1. </span>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<p>We will talk to the backend using the API that the clients use, so we
need a pseudo-user that we can authenticate as.  We assume this user
has been created by other means.  For the sake of testing, you could
just use the team admin (but you don’t need admin privileges for this
user).</p>
<p>So here is some shell environment we will need:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_BACKEND</span><span class="o">=</span>https://prod-nginz-https.wire.com
<span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_USER</span><span class="o">=</span>...
<span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_PASSWD</span><span class="o">=</span>...
<span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_TEAMID</span><span class="o">=</span>...
</pre></div>
</div>
<p>Now you can login and get a wire token to authenticate all further
requests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">BEARER</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Accept: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;email&quot;:&quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$WIRE_USER</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,&quot;password&quot;:&quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$WIRE_PASSWD</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/login<span class="s1">&#39;?persist=false&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.access_token<span class="k">)</span>
</pre></div>
</div>
<p>This token will be good for 15 minutes; after that, just repeat.</p>
<p>If you don’t want to install <a class="reference external" href="https://stedolan.github.io/jq/">jq</a>, you
can just call the <code class="docutils literal notranslate"><span class="pre">curl</span></code> command and copy the access token into the
shell variable manually.</p>
<p>Here is a quick test that you’re logged in:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/self
</pre></div>
</div>
</section>
<section id="contact-requests">
<h2><span class="section-number">2.2. </span>Contact requests<a class="headerlink" href="#contact-requests" title="Permalink to this heading"></a></h2>
<p>If <code class="docutils literal notranslate"><span class="pre">$WIRE_USER</span></code> is in a team, all other team members are implicitly
connected to it.  So for the users in your team, you don’t have to do
anything here.</p>
<p>TODO: contact requests to users not on the team.</p>
</section>
<section id="conversations">
<h2><span class="section-number">2.3. </span>Conversations<a class="headerlink" href="#conversations" title="Permalink to this heading"></a></h2>
<p>To create a converation with no users (except the pseudo-user creating it):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_CONV_NAME</span><span class="o">=</span><span class="s2">&quot;The B-Team&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_CONV</span><span class="o">=</span><span class="s1">&#39;{</span>
<span class="s1">  &quot;users&quot;: [],</span>
<span class="s1">  &quot;name&quot;: &quot;&#39;</span><span class="si">${</span><span class="nv">WIRE_CONV_NAME</span><span class="si">}</span><span class="s1">&#39;&quot;,</span>
<span class="s1">  &quot;team&quot;: {</span>
<span class="s1">    &quot;teamid&quot;: &quot;&#39;</span><span class="si">${</span><span class="nv">WIRE_TEAMID</span><span class="si">}</span><span class="s1">&#39;&quot;</span>
<span class="s1">  },</span>
<span class="s1">  &quot;receipt_mode&quot;: 0,</span>
<span class="s1">  &quot;message_timer&quot;: 0</span>
<span class="s1">}&#39;</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">CONV_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$WIRE_CONV</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/conversations<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.id<span class="k">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">users</span></code> field can contain UUIDs that need to point to existing
wire users (in your team or not), and <code class="docutils literal notranslate"><span class="pre">$WIRE_USER</span></code> needs to have an
accepted connection with them.  You can extract these ids from the
corresponding SCIM user records.  If in doubt, leave empty.</p>
<p>You can also add and remove users once the converation has been
created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{ &quot;users&quot;: [&quot;b4b6a96c-70c8-11e9-99e6-f3ea044b132c&quot;, &quot;b7293854-70c8-11e9-b620-97ff1eba6324&quot;] }&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/conversations/<span class="nv">$CONV_ID</span>/members

curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/conversations/<span class="nv">$CONV_ID</span>/members/b9f1c786-70c8-11e9-91a6-fbeb48cdcdd1
</pre></div>
</div>
<p>You can also look at one or all conversations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/conversations/ids

curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/conversations/

curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/conversations/<span class="nv">$CONV_ID</span>/
</pre></div>
</div>
<p>Finally, conversations can be renamed or deleted:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{ &quot;name&quot;: &quot;The C-Team&quot; }&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/conversations/<span class="nv">$CONV_ID</span>

curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/teams/<span class="nv">$WIRE_TEAMID</span>/conversations/<span class="nv">$CONV_ID</span>
</pre></div>
</div>
</section>
<section id="advanced-topics">
<h2><span class="section-number">2.4. </span>Advanced topics<a class="headerlink" href="#advanced-topics" title="Permalink to this heading"></a></h2>
<p>TODO: pseudo-user leaving the conv, and being added by admin for changes later.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="config-options.html" class="btn btn-neutral float-left" title="1. Config Options" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="elastic-search.html" class="btn btn-neutral float-right" title="3. Maintaining ElasticSearch" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 - 2023, Wire Swiss GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>