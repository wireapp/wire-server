<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>9. Legal hold &mdash; Wire 0.0.4 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/wire.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="10. User Activation" href="../user/activation.html" />
    <link rel="prev" title="7. SCIM tokens" href="../provisioning/scim-token.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href="../../../index.html">
        <img src="../../../_static/Wire_logo.svg" class="logo" alt="Logo"/>
    </a>

    <!--
            <div class="version">
                0.0.4
            </div> -->
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../security-responses/index.html">Security responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/administrate/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../understand/index.html">Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Developers Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../developer/index.html">Developer</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../config-options.html">1. Config Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation.html">2. Creating and populating conversations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../elastic-search.html">3. Maintaining ElasticSearch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../elasticsearch-migration-2021-02-16.html">4. ElasticSearch migration instructions for release 2021-02-16</a></li>
<li class="toctree-l3"><a class="reference internal" href="../make-docker-and-qemu.html">5. Make docker and QEMU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../oauth.html">6. OAuth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../provisioning/scim-token.html">7. SCIM tokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spar-braindump.html">8. Spar braindump</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">9. Legal hold</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#api-and-flows">9.1. API and flows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#events">9.2. Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="#whitelisting-and-implicit-consent">9.3. Whitelisting and implicit consent</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user/activation.html">10. User Activation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/connection.html">11. Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/connection.html#connection-backend-internals">12. Connection backend internals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/registration.html">13. User Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/rich-info.html">14. User Rich info</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Wire</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Notes for developers</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Reference</a></li>
      <li class="breadcrumb-item active"><span class="section-number">9. </span>Legal hold</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/wireapp/wire-server/blob/develop/docs/src/developer/reference/team/legalhold.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="legal-hold">
<h1><span class="section-number">9. </span>Legal hold<a class="headerlink" href="#legal-hold" title="Permalink to this heading"></a></h1>
<p><em>Author: Tiago Loureiro</em></p>
<hr class="docutils" />
<p>Legal hold introduces a new type of device, named <em>legal hold device</em>, for the sake of satisfying corporate compliance rules without sacrificing end to end encryption with full transparency.</p>
<p>A <em>legal hold device</em> is a device bound to a team user account but managed outside of the user’s control - this is managed by the Legal hold service. The management/operation of said Legal hold service is of the responsibility of the team.</p>
<p>This Backend service makes this type of device available for clients that are visually distinguishable, for full transparency, with a clear, constant indication on the UI. There can be only one such device per user account and they can only be added to the user’s device list with the user’s consent and confirmed with a password prompt (if they have one - there can be exceptions such as SSO users).</p>
<p>A team admin may ask members of the team to be put under <a class="reference external" href="https://en.wikipedia.org/wiki/Legal_hold">legal hold</a>. Once a person is prompted, they should then verify that the presented signature matches the one generated by the legalhold service to avoid any potential <a class="reference external" href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITM attack</a>.</p>
<p>Conceptually, there are the following actors in this use case:</p>
<ul class="simple">
<li><p>A team admin - someone who requests legal hold for a specific user</p></li>
<li><p>A team member - the user who will be put under legal hold</p></li>
<li><p>Backend - serves as intermediary between team members/admin and the Legal hold Service</p></li>
<li><p>Legal hold service - stores users’ Legal hold devices on customers’ premises</p></li>
<li><p>Legal hold device - a user’s device that is managed by customers</p></li>
</ul>
<p>Once a user accepts the legal hold request, then a device is added to that user’s account. This device, also known as legal hold device, is managed by the Legal hold service - only team admins can remove that device from a user’s account.</p>
<p>Note that every user talking to someone under legal hold (including, of course, the <em>self</em> user) is made aware by means of displaying a red dot on the user’s profile.</p>
<section id="api-and-flows">
<h2><span class="section-number">9.1. </span>API and flows<a class="headerlink" href="#api-and-flows" title="Permalink to this heading"></a></h2>
<p>Legal hold flow (client perspective)</p>
<p>Request (by admin) for a user to be put under legalhold</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">teams</span><span class="o">/</span><span class="p">{</span><span class="n">tid</span><span class="p">}</span><span class="o">/</span><span class="n">legalhold</span><span class="o">/</span><span class="p">{</span><span class="n">uid</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">201</span> <span class="n">Created</span>
</pre></div>
</div>
<p>Approval by the user</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PUT</span> <span class="o">/</span><span class="n">teams</span><span class="o">/</span><span class="p">{</span><span class="n">tid</span><span class="p">}</span><span class="o">/</span><span class="n">legalhold</span><span class="o">/</span><span class="p">{</span><span class="n">uid</span><span class="p">}</span><span class="o">/</span><span class="n">approve</span>
<span class="p">{</span>
  <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">user</span><span class="s1">&#39;s password&gt; # optional if the user has no set password</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">200</span> <span class="n">OK</span>
</pre></div>
</div>
<p>Deletion by an admin</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="o">/</span><span class="n">teams</span><span class="o">/</span><span class="p">{</span><span class="n">tid</span><span class="p">}</span><span class="o">/</span><span class="n">legalhold</span><span class="o">/</span><span class="p">{</span><span class="n">uid</span><span class="p">}</span>
<span class="p">{</span>
  <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">admin</span><span class="s1">&#39;s password&gt; # optional if the admin has no set password</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">200</span> <span class="n">OK</span>
</pre></div>
</div>
<p>Get Legal hold status for team members</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="o">/</span><span class="n">team</span><span class="o">/</span><span class="p">{</span><span class="n">tid</span><span class="p">}</span><span class="o">/</span><span class="n">members</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">200</span> <span class="n">OK</span>
<span class="o">...</span>
<span class="p">{</span>
    <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">member</span> <span class="n">used</span> <span class="nb">id</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="s2">&quot;legalhold_status&quot;</span><span class="p">:</span> <span class="s2">&quot;disabled&quot;</span> <span class="o">|</span> <span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="o">&lt;--</span> <span class="n">new</span> <span class="n">field</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><img alt="LHFlow" src="https://user-images.githubusercontent.com/1105323/61390098-6bf34800-a8ba-11e9-8ba7-e0759b22a773.png" /></p>
<details>
title: Legal Hold Flow (client perspective)
=: Activation
<p>Admin Panel -&gt; Backend: Activate LH for Alice</p>
<p>Backend -&gt; LegalHold Service: Request to create Cryptobox for Alice (does NOT include scoped token)</p>
<p>LegalHold Service –&gt; Backend: Respond with Public Key etc. for Device</p>
<p>Backend -&gt; Admin Panel: LH for Alice is PENDING
Backend –&gt; Alice’s Client: (Async) Request Approval for LH (includes device fingerprint)</p>
<p>Alice’s Client -&gt; Backend: Alice APPROVES LH</p>
<p>Backend -&gt; LegalHold Service: Send scoped access_token
Backend -&gt; Backend: Add Compliance Device to Alice
Backend -&gt; Admin Panel: LH for Alice is ACTIVE</p>
<p>=: Deactivation</p>
<p>Admin Panel -&gt; Backend: Deactivate LH for Alice
Backend -&gt; Backend: Remove Compliance Device from Alice; revoke access token.</p>
</details>
</section>
<section id="events">
<h2><span class="section-number">9.2. </span>Events<a class="headerlink" href="#events" title="Permalink to this heading"></a></h2>
<p>New legalhold request event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;user.legalhold-request&quot;</span>
<span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">UserID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">one</span> <span class="k">for</span> <span class="n">whom</span> <span class="n">LH</span> <span class="ow">is</span> <span class="n">being</span> <span class="n">requested</span>
<span class="p">,</span> <span class="s2">&quot;last_prekey&quot;</span><span class="p">:</span> <span class="n">Last</span><span class="o">-</span><span class="n">prekey</span> <span class="n">of</span> <span class="n">the</span> <span class="n">legal</span> <span class="n">hold</span> <span class="n">device</span>
<span class="p">,</span> <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">Client</span> <span class="n">ID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">legalhold</span> <span class="n">device</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>New legalhold enabled event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;user.legalhold-enable&quot;</span>
<span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">UserID</span> <span class="k">for</span> <span class="n">whom</span> <span class="n">LH</span> <span class="n">was</span> <span class="n">enabled</span>
<span class="p">}</span>
</pre></div>
</div>
<p>New legalhold disabled event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;user.legalhold-disable&quot;</span>
<span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">UserID</span> <span class="k">for</span> <span class="n">whom</span> <span class="n">LH</span> <span class="n">was</span> <span class="n">disabled</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These events are sent to the user, all team members (including admins) and connections.</p>
</section>
<section id="whitelisting-and-implicit-consent">
<h2><span class="section-number">9.3. </span>Whitelisting and implicit consent<a class="headerlink" href="#whitelisting-and-implicit-consent" title="Permalink to this heading"></a></h2>
<p>This release introduces a notion of intial “consent” to legalhold
(LH): In addition to the popup before getting exposed to LH devices
(either by getting assigned one or by entering a conversation or
connection with one present), users needs to grant their consent to
even have the option of being exposed.  Until they do, they may be
blocked from using wire by their team admin (if they are a team user),
but they cannot be assigned a LH device, and they cannot enter
conversations with LH devices present.</p>
<p>For now, there isn’t any UI for the user to grant their initial consent.
Instead, an “implict consent” can be given by the site operator by setting</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">featureFlags</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># [...]</span>
<span class="w">    </span><span class="nt">legalhold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whitelist-teams-and-implicit-consent</span>
</pre></div>
</div>
<p>in galley’s config and then using non-exposed, internal endpoints on the galley
pod to update the set of teams whose users are considered to have given their
initial consent:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">put</span> <span class="pre">/i/legalhold/whitelisted-teams/:team-id</span></code> - Add team</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">/i/legalhold/whitelisted-teams/:team-id</span></code> - Remove team</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">/i/legalhold/whitelisted-teams</span></code> - List all teams</p></li>
</ul>
<p>Since consent is required for LH to work, users in teams that are not
whitelisted cannot be assigned LH devices (pull request #1502), and
they are blocked or removed from conversations that are exposed to LH
devices (#1507, #1595).</p>
<section id="implementation-status-and-future-work">
<h3><span class="section-number">9.3.1. </span>Implementation status and future work<a class="headerlink" href="#implementation-status-and-future-work" title="Permalink to this heading"></a></h3>
<p>The notion of consent is introduced to make it explicit, ie. users
would have UI components to grant consent themselves, and there would
be clear feedback in situations where communication is blocked for
lack of consent, so that these situations can be resolved offline.</p>
<p>Whitelisting and implicit consent is a short cut.  The server side
already implements granting explicit consent, but until the UI is
ready, site operators have the option of allowing LH to function on a
fixed set of teams.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../provisioning/scim-token.html" class="btn btn-neutral float-left" title="7. SCIM tokens" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../user/activation.html" class="btn btn-neutral float-right" title="10. User Activation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 - 2023, Wire Swiss GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>