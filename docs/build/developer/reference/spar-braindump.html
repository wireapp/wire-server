<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8. Spar braindump &mdash; Wire 0.0.4 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/wire.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Restund (TURN) servers" href="../../understand/restund.html" />
    <link rel="prev" title="How to set up SSO integration with Okta" href="../../understand/single-sign-on/okta/main.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href="../../index.html">
        <img src="../../_static/Wire_logo.svg" class="logo" alt="Logo"/>
    </a>

    <!--
            <div class="version">
                0.0.4
            </div> -->
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../security-responses/index.html">Security responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/administrate/index.html">Administration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../understand/index.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../understand/overview.html">Architecture Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../understand/single-sign-on/index.html">Single Sign-On and User Provisioning</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../understand/single-sign-on/understand/main.html">Single sign-on and user provisioning: the user manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../understand/single-sign-on/trouble-shooting.html">Trouble shooting and FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../understand/single-sign-on/generic-setup.html">Generic setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../understand/single-sign-on/adfs/main.html">SSO integration with ADFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../understand/single-sign-on/azure/main.html">SSO integration with Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../understand/single-sign-on/centrify/main.html">SSO integration with Centrify</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../understand/single-sign-on/okta/main.html">SSO integration with Okta</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">8. Internals for the intensely curious</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#related-documentation">8.1. related documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#operations">8.2. operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-logic">8.3. application logic</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/restund.html">Audio/video calling, restund servers (TURN/STUN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/sft.html">Conference Calling 2.0 (aka SFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/sft.html#federated-conference-calling">Federated Conference Calling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/minio.html">Minio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/helm.html">Helm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/federation/index.html">Federation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/associate/index.html">Connecting Wire Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/api-client-perspective/index.html">Client API documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/crypto-libs.html">Crypto libraries and sources of randomness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/block-user-creation.html">Block personal user creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/classified-domains.html">Classified Domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/configure-federation.html">Federation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/legalhold.html">Installing and setting up Legal Hold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/mls.html">Messaging Layer Security (MLS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/searchability.html">User Searchability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../understand/team-feature-settings.html">Server and team feature settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Developers Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Wire</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../understand/index.html">Reference</a></li>
          <li class="breadcrumb-item"><a href="../../understand/single-sign-on/index.html">Single Sign-On and User Provisioning</a></li>
      <li class="breadcrumb-item active"><span class="section-number">8. </span>Spar braindump</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/wireapp/wire-server/blob/develop/docs/src/developer/reference/spar-braindump.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="spar-braindump">
<h1><span class="section-number">8. </span>Spar braindump<a class="headerlink" href="#spar-braindump" title="Permalink to this heading"></a></h1>
<p>Reference: {#SparBrainDump}
/home/stefan/repos/wire-server/docs/src/how-to/install/includes/helm_dns-ingress-troubleshooting.inc.rst:147: WARNING: duplicate label trying things out, other instance in /home/stefan/repos/wire-server/docs/src/how-to/install/helm.md
/home/stefan/repos/wire-server/docs/src/how-to/install/includes/helm_dns-ingress-troubleshooting.inc.rst:170: WARNING: duplicate label troubleshooting, other instance in /home/stefan/repos/wire-server/docs/src/how-to/install/helm.md
/home/stefan/repos/wire-server/docs/src/developer/reference/config-options.md:33: WARNING: ‘myst’ reference target not found: ../../how-to/install/mls.md
/home/stefan/repos/wire-server/docs/src/developer/reference/spar-braindump.md:116: WARNING: ‘myst’ reference target not found: ../../how-to/single-sign-on/understand/main.rst
/home/stefan/repos/wire-server/docs/src/how-to/install/ansible-VMs.md:97: WARNING: undefined label: ‘checks’
/home/stefan/repos/wire-server/docs/src/understand/federation/api.md:162: WARNING: ‘myst’ reference target not found: ../../how-to/install/mls
<em>Author: Matthias Fischmann</em></p>
<hr class="docutils" />
<p>this is a mix of information on inmplementation details, architecture,
and operation.  it should probably be sorted into different places in
the future, but if you can’t find any more well-structured
documentation answering your questions, look here!</p>
<section id="related-documentation">
<h2><span class="section-number">8.1. </span>related documentation<a class="headerlink" href="#related-documentation" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.wire.com/how-to/single-sign-on/index.html">list of howtos for supported SAML IdP vendors</a></p></li>
<li><p><a class="reference external" href="https://docs.wire.com/understand/single-sign-on/design.html">fragment</a>  (TODO: clean up the section “common misconceptions” below and move it here.)</p></li>
<li><p><a class="reference external" href="https://support.wire.com/hc/en-us/categories/360000248538?section=administration%3Fsection%3Dadministration">official docs for team admin from customer support</a>  (skip to “Authentication”)</p></li>
<li><p><a class="reference external" href="https://github.com/wireapp/wire-server/blob/develop/docs/reference/provisioning/scim-via-curl.md">talk scim using curl</a></p></li>
<li><p>if you want to work on our saml/scim implementation and do not have access to [https://github.com/zinfra/backend-issues/issues?q=is%3Aissue+is%3Aopen+label%3Aspar] and [https://github.com/wireapp/design-specs/tree/master/Single%20Sign%20On], please get in touch with us.</p></li>
</ul>
</section>
<section id="operations">
<h2><span class="section-number">8.2. </span>operations<a class="headerlink" href="#operations" title="Permalink to this heading"></a></h2>
<section id="enabling-disabling-the-sso-feature-for-a-team">
<h3><span class="section-number">8.2.1. </span>enabling / disabling the sso feature for a team<a class="headerlink" href="#enabling-disabling-the-sso-feature-for-a-team" title="Permalink to this heading"></a></h3>
<p>if you have sso disabled by default, you need to turn on the feature
for every team that wants to use it.  you can do this in the stern
service (aka backoffice).  look for <code class="docutils literal notranslate"><span class="pre">get/put</span> <span class="pre">/teams/{tid}/features/sso</span></code></p>
</section>
<section id="registering-an-idp-with-a-team-via-curl">
<h3><span class="section-number">8.2.2. </span>registering an idp with a team via curl<a class="headerlink" href="#registering-an-idp-with-a-team-via-curl" title="Permalink to this heading"></a></h3>
<p>you need to have:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># user id of an admin of the team (or the creator from the team info</span>
<span class="c1"># in the backoffice, if you only have the team id).</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ADMIN_ID</span><span class="o">=</span>...

<span class="c1"># path of the xml metadata file (if you only have the url, curl it)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">METADATA_FILE</span><span class="o">=</span>...
</pre></div>
</div>
<p>copy these two files to one of your spar instances:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.../wire-server/hack/bin/register_idp_internal.sh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${METADATA_FILE}</span></code></p></li>
</ul>
<p>…  and ssh into it.  then:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./register_idp_internal.sh<span class="w"> </span>metadata.xml<span class="w"> </span><span class="si">${</span><span class="nv">TEAM_OWNER_ID</span><span class="si">}</span>
</pre></div>
</div>
<p>the output contains the a json object representing the idp.  construct
the login code from the <code class="docutils literal notranslate"><span class="pre">id</span></code> field of that object by adding <code class="docutils literal notranslate"><span class="pre">wire-</span></code> in
front, eg.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wire</span><span class="o">-</span><span class="n">e97fbe2e</span><span class="o">-</span><span class="n">eeb1</span><span class="o">-</span><span class="mf">11e9</span><span class="o">-</span><span class="n">acf3</span><span class="o">-</span><span class="mi">9</span><span class="n">ba77d8a04bf</span>
</pre></div>
</div>
<p>give this login code to the users that you want to connect to wire
using this idp.  see
<a class="reference external" href="https://support.wire.com/hc/en-us/articles/360000954617-Login-with-SSO">here</a>
on how to use the login code.</p>
</section>
<section id="updating-an-idp-via-curl">
<h3><span class="section-number">8.2.3. </span>updating an idp via curl<a class="headerlink" href="#updating-an-idp-via-curl" title="Permalink to this heading"></a></h3>
<p>Your IdP metadata may change over time (eg., because a certificate
expires, or because you change vendor and all the metadata looks
completely different), these changes need to be updated in wire.  We
offer two options to do that.</p>
<p>Like when creating your first IdP, for both options you need define a
few things:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># user id of an admin of the team (or the creator from the team info</span>
<span class="c1"># in the backoffice, if you only have the team id).</span>
<span class="n">export</span> <span class="n">ADMIN_ID</span><span class="o">=...</span>

<span class="c1"># path of the xml metadata file (if you only have the url, curl it)</span>
<span class="n">export</span> <span class="n">METADATA_FILE</span><span class="o">=...</span>

<span class="c1"># The ID of the IdP you want to update (login code without the `wire-`</span>
<span class="c1"># prefix, which is a UUIDv4):</span>
<span class="n">export</span> <span class="n">IDP_ID</span><span class="o">=...</span>
</pre></div>
</div>
<p>Copy the new metadata file to one of your spar instances.</p>
<p>Ssh into it.  If you can’t, <a class="reference internal" href="../../understand/single-sign-on/index.html#sso-main-documentation"><span class="std std-ref">the sso docs</span></a> explain how you can create a
bearer token if you have the admin’s login credentials.  If you follow
that approach, you need to replace all mentions of <code class="docutils literal notranslate"><span class="pre">-H'Z-User</span> <span class="pre">...'</span></code>
with <code class="docutils literal notranslate"><span class="pre">-H'Authorization:</span> <span class="pre">Bearer</span> <span class="pre">...'</span></code> in the following, and you won’t need
<code class="docutils literal notranslate"><span class="pre">$ADMIN_ID</span></code>, but something like <code class="docutils literal notranslate"><span class="pre">$BEARER</span></code>.</p>
<p>There are two ways to update an IDP, described below, each with their own tradeoffs that affect users.</p>
<section id="option-1-update-the-existing-idp-in-place">
<h4><span class="section-number">8.2.3.1. </span>Option 1: Update the existing IdP in-place<a class="headerlink" href="#option-1-update-the-existing-idp-in-place" title="Permalink to this heading"></a></h4>
<p>Effects:</p>
<ul class="simple">
<li><p>You keep the login code, no visible changes for your users.</p></li>
<li><p>The old IdP becomes immediately unaccessible.  It will disappear
from team-settings, and users will have no way of using it for
authentication.</p></li>
<li><p>If the has no account on the new IdP, she won’t be able to login.</p></li>
<li><p>If a user has an account on the new IdP, <em>but not with exactly the
same user name</em> (SAML NameID), she will not be logged in to their
old account.  Instead, depending on your setup, a second account is
created for them, or they are blocked (both not what you want).</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-v<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-XPUT<span class="w"> </span>http://localhost:8080/identity-providers/<span class="si">${</span><span class="nv">IDP_ID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="s2">&quot;Z-User: </span><span class="si">${</span><span class="nv">ADMIN_ID</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="s1">&#39;Content-type: application/xml&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-d@<span class="s2">&quot;</span><span class="si">${</span><span class="nv">METADATA_FILE</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="option-2-create-a-second-idp-and-mark-it-as-replacing-the-old-one">
<h4><span class="section-number">8.2.3.2. </span>Option 2: Create a second IdP, and mark it as replacing the old one.<a class="headerlink" href="#option-2-create-a-second-idp-and-mark-it-as-replacing-the-old-one" title="Permalink to this heading"></a></h4>
<p>Effects:</p>
<ul class="simple">
<li><p>The new IdP will have a new login code.  Users need to be invited to
use this new login code.</p></li>
<li><p>If they use the old login code, they can keep using the old IdP as
long as it is still running as before.  (This option is good for
smooth transitions from one IdP to the other.)</p></li>
<li><p>If they use the new login code, they will be automatically moved
from the old IdP to the new one.  After that, they won’t be able to
use the old one any more.</p></li>
<li><p>If a user logs into the team for the first time using the old login
code, no user will be created.  The old IdP is marked as “replaced”,
and wire only authenticates existing users with it.</p></li>
<li><p>This doesn’t currently work if you are using SCIM for provisioning,
because SCIM requires you to have exactly one IdP configured in your
wire team.  (Internal details:
https://github.com/zinfra/backend-issues/issues/1365,
https://github.com/zinfra/backend-issues/issues/1377).</p></li>
<li><p>If you go to team settings, you will see the old IdP and the new
one, and there is currently no way to distinguish between replaced
and active IdPs.  (Internal details:
https://github.com/wireapp/wire-team-settings/issues/3465).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -v \
     -XPOST http://localhost:8080/identity-providers&#39;?replaces=&#39;${IDP_ID} \
     -H&quot;Z-User: ${ADMIN_ID}&quot; \
     -H&#39;Content-type: application/xml&#39; \
     -d@&quot;${METADATA_FILE}&quot;
</pre></div>
</div>
</section>
</section>
<section id="deleting-an-idp-via-curl">
<h3><span class="section-number">8.2.4. </span>deleting an idp via curl<a class="headerlink" href="#deleting-an-idp-via-curl" title="Permalink to this heading"></a></h3>
<p>Read the beginning of the last section up to “Option 1”.  You need
<code class="docutils literal notranslate"><span class="pre">ADMIN_ID</span></code> (or <code class="docutils literal notranslate"><span class="pre">BEARER</span></code>) and <code class="docutils literal notranslate"><span class="pre">IDP_ID</span></code>, but not <code class="docutils literal notranslate"><span class="pre">METADATA_FILE</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -v
     -XDELETE http://localhost:8080/identity-providers/${IDP_ID} \
     -H&quot;Z-User: ${ADMIN_ID}&quot; \
     -H&#39;Content-type: application/json
</pre></div>
</div>
<p>If there are still users in your team with SAML credentials associated
with this IdP, you will get an error.  You can either move these users
elsewhere, delete them manually, or purge them implicitly during
deletion of the IdP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -v
     -XDELETE http://localhost:8080/identity-providers/${IDP_ID}?purge=true \
     -H&quot;Z-User: ${ADMIN_ID}&quot; \
     -H&#39;Content-type: application/json
</pre></div>
</div>
<p>Haskell code: https://github.com/wireapp/wire-server/blob/d231550f67c117b7d100c7c8c6c01b5ad13b5a7e/services/spar/src/Spar/API.hs#L217-L271</p>
</section>
<section id="setting-a-default-sso-code">
<h3><span class="section-number">8.2.5. </span>setting a default SSO code<a class="headerlink" href="#setting-a-default-sso-code" title="Permalink to this heading"></a></h3>
<p>To avoid having to give users the login code, a backend can also provide a default code on the endpoint <code class="docutils literal notranslate"><span class="pre">/sso/settings</span></code>.
This needs to be set explicitly, since this is not always wanted and there might even be multiple idps (each with their own login code):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -XPUT ${API_URL}/i/sso/settings -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;default_sso_code&quot;:&quot;e97fbe2e-eeb1-11e9-acf3-9ba77d8a04bf&quot;}&#39;
</pre></div>
</div>
<p>Note the lack of the <code class="docutils literal notranslate"><span class="pre">wire-</span></code> prefix.</p>
<p>This entry gets removed automatically when the corresponding idp is deleted. You can manually delete the default by making a <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request as shown above with payload <code class="docutils literal notranslate"><span class="pre">{&quot;default_sso_code&quot;:null}</span></code>.</p>
<p>Clients can then ask for the default SSO code on <code class="docutils literal notranslate"><span class="pre">/sso/settings</span></code> and use it to initiate single sign-on.</p>
</section>
<section id="common-misconceptions">
<h3><span class="section-number">8.2.6. </span>common misconceptions<a class="headerlink" href="#common-misconceptions" title="Permalink to this heading"></a></h3>
<section id="an-email-address-can-be-one-of-two-things">
<h4><span class="section-number">8.2.6.1. </span>an email address can be one of two things<a class="headerlink" href="#an-email-address-can-be-one-of-two-things" title="Permalink to this heading"></a></h4>
<p>When users are SAML-authenticated with an email address under NameID,
that email address is used by wire as an opaque identifier, not to
send actual emails.  In order to <em>also</em> assign the user that email
address, you can enable the feature flag <code class="docutils literal notranslate"><span class="pre">validateSAMLemails</span></code>.  This
will trigger the regular email validation flow that is also triggered
when the user changes their email themselves.</p>
</section>
<section id="scim-provisioning-metadata">
<h4><span class="section-number">8.2.6.2. </span>scim, provisioning, metadata<a class="headerlink" href="#scim-provisioning-metadata" title="Permalink to this heading"></a></h4>
<p>for changing the user information (name, handle, email, …), saml
isn’t enough.  the identity management software (AD in this case, or
some add-on) needs to support scim.  we <em>could</em> support doing that via
saml, but the part of the standards that are needed for that are even
in worse shape than the ones for the authentication bits, and it would
not lead to a good user experience.  so instead we require users to
adopt the more robust and contemporary scim standard.</p>
</section>
</section>
</section>
<section id="application-logic">
<h2><span class="section-number">8.3. </span>application logic<a class="headerlink" href="#application-logic" title="Permalink to this heading"></a></h2>
<section id="deleting-users-that-exist-on-spar">
<h3><span class="section-number">8.3.1. </span>deleting users that exist on spar<a class="headerlink" href="#deleting-users-that-exist-on-spar" title="Permalink to this heading"></a></h3>
<p>For scim- or saml-created users, there are three locations for user data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">brig.user</span></code> (and a few things associated with that on brig and galley)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spar.user</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spar.scim_user</span></code></p></li>
</ul>
<p>The single source of truth is <code class="docutils literal notranslate"><span class="pre">brig.user</span></code>.  Dangling entries in the
other places are allowed, and must be checked by the application code
for danglingness.  (<a class="reference external" href="https://github.com/wireapp/wire-server/blob/010ca7e460d13160b465de24dd3982a397f94c16/services/spar/test-integration/Test/Spar/Scim/UserSpec.hs#L239-L308">test case for
scim</a>;
<a class="reference external" href="https://github.com/wireapp/wire-server/blob/293518655d7bae60fbcb0c4aaa06034785bfb6fc/services/spar/test-integration/Test/Spar/APISpec.hs#L742-L795">test case for
saml</a>)</p>
<p>For the semantics of interesting corner cases, consult <a class="reference external" href="https://github.com/wireapp/wire-server/blob/develop/services/spar/test-integration/Test/Spar/APISpec.hs">the test
suite</a>.
If you can’t find what you’re looking for there, please add at least a
pending test case explaining what’s missing.</p>
<p>Side note: Users in brig carry an enum type
<a class="reference external" href="https://github.com/wireapp/wire-server/blob/010ca7e460d13160b465de24dd3982a397f94c16/libs/brig-types/src/Brig/Types/Common.hs#L393-L413"><code class="docutils literal notranslate"><span class="pre">ManagedBy</span></code></a>.  This is a half-implemented feature for
managing conflicts between changes via scim vs. changes from wire
clients; and does currently not affect deletability of users.</p>
<section id="delete-via-deleting-idp">
<h4><span class="section-number">8.3.1.1. </span>delete via deleting idp<a class="headerlink" href="#delete-via-deleting-idp" title="Permalink to this heading"></a></h4>
<p><a class="reference external" href="https://github.com/wireapp/wire-server/blob/d231550f67c117b7d100c7c8c6c01b5ad13b5a7e/services/spar/src/Spar/API.hs#L217-L271">Currently</a>, we only have the rest API for this.  Team settings will follow with a button.</p>
</section>
<section id="user-deletes-herself">
<h4><span class="section-number">8.3.1.2. </span>user deletes herself<a class="headerlink" href="#user-deletes-herself" title="Permalink to this heading"></a></h4>
<p>TODO</p>
</section>
<section id="delete-in-team-settings">
<h4><span class="section-number">8.3.1.3. </span>delete in team settings<a class="headerlink" href="#delete-in-team-settings" title="Permalink to this heading"></a></h4>
<p>TODO (probably little difference between this and “user deletes herself”?)</p>
</section>
<section id="delete-via-scim">
<h4><span class="section-number">8.3.1.4. </span>delete via scim<a class="headerlink" href="#delete-via-scim" title="Permalink to this heading"></a></h4>
<p>TODO</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../understand/single-sign-on/okta/main.html" class="btn btn-neutral float-left" title="How to set up SSO integration with Okta" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../understand/restund.html" class="btn btn-neutral float-right" title="Restund (TURN) servers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 - 2023, Wire Swiss GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>