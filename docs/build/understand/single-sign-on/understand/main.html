<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Single sign-on and user provisioning &mdash; Wire 0.0.4 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/wire.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Trouble shooting &amp; FAQ" href="../trouble-shooting.html" />
    <link rel="prev" title="Single Sign-On and User Provisioning" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href="../../../index.html">
        <img src="../../../_static/Wire_logo.svg" class="logo" alt="Logo"/>
    </a>

    <!--
            <div class="version">
                0.0.4
            </div> -->
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../security-responses/index.html">Security responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/administrate/index.html">Administration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview.html">Architecture Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Single Sign-On and User Provisioning</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Single sign-on and user provisioning: the user manual</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#further-reading">Further reading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#definitions">Definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-login-for-the-first-time-with-sso">User login for the first time with SSO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#saml-sso">SAML/SSO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-provisioning-scim-ldap">User provisioning (SCIM/LDAP)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trouble-shooting.html">Trouble shooting and FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generic-setup.html">Generic setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adfs/main.html">SSO integration with ADFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../azure/main.html">SSO integration with Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../centrify/main.html">SSO integration with Centrify</a></li>
<li class="toctree-l3"><a class="reference internal" href="../okta/main.html">SSO integration with Okta</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../developer/reference/spar-braindump.html">8. Internals for the intensely curious</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../restund.html">Audio/video calling, restund servers (TURN/STUN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sft.html">Conference Calling 2.0 (aka SFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sft.html#federated-conference-calling">Federated Conference Calling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../minio.html">Minio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../helm.html">Helm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../federation/index.html">Federation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../associate/index.html">Connecting Wire Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api-client-perspective/index.html">Client API documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto-libs.html">Crypto libraries and sources of randomness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../block-user-creation.html">Block personal user creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../classified-domains.html">Classified Domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configure-federation.html">Federation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../legalhold.html">Installing and setting up Legal Hold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mls.html">Messaging Layer Security (MLS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../searchability.html">User Searchability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../team-feature-settings.html">Server and team feature settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developers Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Wire</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Reference</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Single Sign-On and User Provisioning</a></li>
      <li class="breadcrumb-item active">Single sign-on and user provisioning</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/wireapp/wire-server/blob/develop/docs/src/understand/single-sign-on/understand/main.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="single-sign-on-and-user-provisioning">
<h1><a class="toc-backref" href="#id5" role="doc-backlink">Single sign-on and user provisioning</a><a class="headerlink" href="#single-sign-on-and-user-provisioning" title="Permalink to this heading"></a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#single-sign-on-and-user-provisioning" id="id5">Single sign-on and user provisioning</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id6">Introduction</a></p></li>
<li><p><a class="reference internal" href="#further-reading" id="id7">Further reading</a></p></li>
<li><p><a class="reference internal" href="#definitions" id="id8">Definitions</a></p></li>
<li><p><a class="reference internal" href="#user-login-for-the-first-time-with-sso" id="id9">User login for the first time with SSO</a></p></li>
<li><p><a class="reference internal" href="#saml-sso" id="id10">SAML/SSO</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id11">Introduction</a></p></li>
<li><p><a class="reference internal" href="#terminology-and-concepts" id="id12">Terminology and concepts</a></p></li>
<li><p><a class="reference internal" href="#setting-up-sso-externally" id="id13">Setting up SSO externally</a></p></li>
<li><p><a class="reference internal" href="#setting-up-sso-internally" id="id14">Setting up SSO internally</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#user-provisioning-scim-ldap" id="id15">User provisioning (SCIM/LDAP)</a></p>
<ul>
<li><p><a class="reference internal" href="#scim-management-in-wire-in-team-management" id="id16">SCIM management in Wire (in Team Management)</a></p>
<ul>
<li><p><a class="reference internal" href="#scim-security-and-authentication" id="id17">SCIM security and authentication</a></p></li>
<li><p><a class="reference internal" href="#generating-a-scim-token" id="id18">Generating a SCIM token</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-scim-via-curl" id="id19">Using SCIM via Curl</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-a-scim-token" id="id20">Creating a SCIM token</a></p></li>
<li><p><a class="reference internal" href="#using-a-scim-token-to-create-read-update-and-delete-crud-users" id="id21">Using a SCIM token to Create Read Update and Delete (CRUD) users</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This page is intended as a manual for administrator users in need of setting up <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> and provisionning users using <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> on their installation of Wire.</p>
<p>Historically and by default, Wire’s user authentication method is via phone or password. This has security implications and does not scale.</p>
<p>Solution: <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> with <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a>! <a class="reference external" href="https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language">(Security Assertion Markup Language)</a></p>
<p><a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> systems allow users to identify on multiple systems (including Wire once configured as such) using a single ID and password.</p>
<p>You can find some of the advantages of <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> over more traditional schemes <a class="reference external" href="https://en.wikipedia.org/wiki/Single_sign-on">here</a>.</p>
<p>Also historically, wire has allowed team admins and owners to manage their users in the team management app.</p>
<p>This does not scale as it requires a lot of manual labor for each user.</p>
<p>The solution we offer to solve this issue is implementing <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> <a class="reference external" href="https://en.wikipedia.org/wiki/System_for_Cross-domain_Identity_Management">(System for Cross-domain Identity Management)</a></p>
<p><a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> is an interface that allows both software (for example Active Directory) and custom scripts to manage Identities (users) in bulk.</p>
<p>This page explains how to set up <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> and then use it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that it is recommended to use both <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> and <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> (as opposed to just <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> alone).
The reason is if you only use <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a>, but do not configure/implement <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a>, you will experience reduced functionality.
In particular, without <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> all Wire users will be named according their e-mail address and won’t have any rich profiles.
See below in the <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> section for a more detailled explanation.</p>
</div>
</section>
<section id="further-reading">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Further reading</a><a class="headerlink" href="#further-reading" title="Permalink to this heading"></a></h2>
<p>If you can’t find the answers to your questions here, we have a few
more documents.  Some of them are very technical, some may not be up
to date any more, and we are planning to move many of them into this
page.  But for now they may be worth checking out.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../trouble-shooting.html#trouble-shooting-faq"><span class="std std-ref">Trouble shooting &amp; FAQ</span></a></p></li>
<li><p><a class="reference external" href="https://support.wire.com/hc/en-us/sections/360000580658-Authentication">https://support.wire.com/hc/en-us/sections/360000580658-Authentication</a></p></li>
<li><p><a class="reference external" href="https://github.com/wireapp/wire-server/blob/1753b790e5cfb2d35e857648c88bcad3ac329f01/docs/reference/spar-braindump.md">https://github.com/wireapp/wire-server/blob/1753b790e5cfb2d35e857648c88bcad3ac329f01/docs/reference/spar-braindump.md</a></p></li>
<li><p><a class="reference external" href="https://github.com/wireapp/wire-server/tree/1753b790e5cfb2d35e857648c88bcad3ac329f01/docs/reference/provisioning/">https://github.com/wireapp/wire-server/tree/1753b790e5cfb2d35e857648c88bcad3ac329f01/docs/reference/provisioning/</a></p></li>
</ul>
</section>
<section id="definitions">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Definitions</a><a class="headerlink" href="#definitions" title="Permalink to this heading"></a></h2>
<p>The following concepts need to be understood to use the present manual:</p>
<dl class="glossary">
<dt id="term-SCIM">SCIM<a class="headerlink" href="#term-SCIM" title="Permalink to this term"></a></dt><dd><p>System for Cross-domain Identity Management (<a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a>) is a standard for automating the exchange of user identity information between identity domains, or IT systems.</p>
<p>One example might be that as a company onboards new employees and separates from existing employees, they are added and removed from the company’s electronic employee directory. <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> could be used to automatically add/delete (or, provision/de-provision) accounts for those users in external systems such as G Suite, Office 365, or Salesforce.com. Then, a new user account would exist in the external systems for each new employee, and the user accounts for former employees might no longer exist in those systems.</p>
<p>See: <a class="reference external" href="https://en.wikipedia.org/wiki/System_for_Cross-domain_Identity_Management">System for Cross-domain Identity Management at Wikipedia</a></p>
<p>In the context of Wire, SCIM is the interface offered by the Wire service (in particular the spar service) that allows for single or mass automated addition/removal of user accounts.</p>
</dd>
<dt id="term-SSO">SSO<a class="headerlink" href="#term-SSO" title="Permalink to this term"></a></dt><dd><p>Single sign-on (<a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a>) is an authentication scheme that allows a user to log in with a single ID and password to any of several organizationally related, yet independent, software systems.</p>
<p>True single sign-on allows the user to log in once and access different, independent services without re-entering authentication factors.</p>
<p>See: <a class="reference external" href="https://en.wikipedia.org/wiki/Single_sign-on">Single-Sign-On at Wikipedia</a></p>
</dd>
<dt id="term-SAML">SAML<a class="headerlink" href="#term-SAML" title="Permalink to this term"></a></dt><dd><p>Security Assertion Markup Language (<a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a>, pronounced SAM-el, /’sæməl/) is an open standard for exchanging authentication and authorization data between parties, in particular, between an identity provider and a service provider. <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a> is an XML-based markup language for security assertions (statements that service providers use to make access-control decisions). <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a> is also:</p>
<ul class="simple">
<li><p>A set of XML-based protocol messages</p></li>
<li><p>A set of protocol message bindings</p></li>
<li><p>A set of profiles (utilizing all of the above)</p></li>
</ul>
<p>An important use case that <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a> addresses is web-browser <a class="reference external" href="https://en.wikipedia.org/wiki/Single_sign-on">single sign-on (SSO)</a> . Single sign-on is relatively easy to accomplish within a security domain (using cookies, for example) but extending <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> across security domains is more difficult and resulted in the proliferation of non-interoperable proprietary technologies. The <a class="reference external" href="https://en.wikipedia.org/wiki/Single_sign-on">SAML Web Browser SSO</a> profile was specified and standardized to promote interoperability.</p>
<p>See: <a class="reference external" href="https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language">SAML at Wikipedia</a></p>
<p>In the context of Wire, SAML is the standard/protocol used by the Wire services (in particular the spar service) to provide the Single Sign On feature.</p>
</dd>
<dt id="term-IdP">IdP<a class="headerlink" href="#term-IdP" title="Permalink to this term"></a></dt><dd><p>In the context of Wire, an identity provider (abbreviated <a class="reference internal" href="#term-IdP"><span class="xref std std-term">IdP</span></a>) is a service that provides SAML single sign-on (<a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a>) credentials that give users access to Wire.</p>
</dd>
<dt id="term-Curl">Curl<a class="headerlink" href="#term-Curl" title="Permalink to this term"></a></dt><dd><p><a class="reference internal" href="#term-Curl"><span class="xref std std-term">Curl</span></a> (pronounced “<a class="reference internal" href="#term-Curl"><span class="xref std std-term">Curl</span></a>”) is a command line tool used to download files over the HTTP (web) protocol. For example, <cite>curl http://wire.com</cite> will download the <code class="docutils literal notranslate"><span class="pre">wire.com</span></code> web page.</p>
<p>In this manual, it is used to contact API (Application Programming Interface) endpoints manually, where those endpoints would normally be accessed by code or other software.</p>
<p>This can be used either for illustrative purposes (to “show” how the endpoints can be used) or to allow the manual execution of some simple tasks.</p>
<p>For example (not a real endpoint) <cite>curl http://api.wire.com/delete_user/thomas</cite> would (schematically) execute the <a class="reference internal" href="#term-Curl"><span class="xref std std-term">Curl</span></a> command, which would contact the wire.com API and delete the user named “thomas”.</p>
<p>Running this command in a terminal would cause the <a class="reference internal" href="#term-Curl"><span class="xref std std-term">Curl</span></a> command to access this URL, and the API at that URL would execute the requested action.</p>
<p>See: <a class="reference external" href="https://en.wikipedia.org/wiki/Curl">curl at Wikipedia</a></p>
</dd>
<dt id="term-Spar">Spar<a class="headerlink" href="#term-Spar" title="Permalink to this term"></a></dt><dd><p>The Wire backend software stack is composed of different services, <a class="reference external" href="../overview.html#focus-on-pods">running as pods</a> in a kubernetes cluster.</p>
<p>One of those pods is the “spar” service. That service/pod is dedicated to the providing <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> (using <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a>) and <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> services. This page is the manual for this service.</p>
<p>In the context of <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a>, Wire’s spar service is the <a class="reference external" href="https://en.wikipedia.org/wiki/Service_provider_(SAML)">Service Provider</a> that Identity Management Software
(for example Azure, Okta, Ping Identity, SailPoint, Technology Nexus, etc.) uses for user account provisioning and deprovisioning.</p>
</dd>
</dl>
</section>
<section id="user-login-for-the-first-time-with-sso">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">User login for the first time with SSO</a><a class="headerlink" href="#user-login-for-the-first-time-with-sso" title="Permalink to this heading"></a></h2>
<p><a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> allows users to register and log into Wire with their company credentials that they use on other software in their workplace.
No need to remember another password.</p>
<p>When a team is set up on Wire, the administrators can provide users a login code or link that they can use to go straight to their company’s login page.</p>
<p>Here is what this looks from a user’s perspective:</p>
<ol class="arabic simple">
<li><p>Download Wire.</p></li>
<li><p>Select and copy the code that your company gave you / the administrator generated</p></li>
<li><p>Open Wire.  Wire may detect the code on your clipboard and open a pop-up window with a text field.
Wire will automatically put the code into the text field.
If so, click Log in and go to step 8.</p></li>
<li><p>If no pop-up: click Login on the first screen.</p></li>
<li><p>Click Enterprise Login.</p></li>
<li><p>A pop-up will appear. In the text field, paste or type the code your company gave you.</p></li>
<li><p>Click Log in.</p></li>
<li><p>Wire will load your company’s login page: log in with your company credentials.</p></li>
</ol>
</section>
<section id="saml-sso">
<span id="id1"></span><h2><a class="toc-backref" href="#id10" role="doc-backlink">SAML/SSO</a><a class="headerlink" href="#saml-sso" title="Permalink to this heading"></a></h2>
<section id="id2">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Introduction</a><a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>SSO (Single Sign-On) is technology allowing users to sign into multiple services with a single identity provider/credential.</p>
<p>SSO is about <code class="docutils literal notranslate"><span class="pre">authentication</span></code>, not <code class="docutils literal notranslate"><span class="pre">provisioning</span></code> (create, update, remove user accounts).  To learn more about the latter, continue  <a class="reference internal" href="#user-provisioning-scim-ldap"><span class="std std-ref">below</span></a>.</p>
<p>For example, if a company already has SSO setup for some of their services, and they start using Wire, they can use Wire’s SSO support to add Wire to the set of services their users will be able to sign into with their existing SSO credentials.</p>
<p>Here is a blog post we like about how SAML works: <a class="reference external" href="https://duo.com/blog/the-beer-drinkers-guide-to-saml">https://duo.com/blog/the-beer-drinkers-guide-to-saml</a></p>
<p>And here is a diagram that explains it in slightly more technical terms:</p>
<p class="plantuml">
<img src="../../../_images/plantuml-14d4b2c7c2034c3867e701772fb6ef2d16958934.png" alt="&#64;startuml

title Wire SAML Authentication Flow
hide footbox
skinparam responseMessageBelowArrow true

actor &quot;**End User**\n(Mobile, Desktop, WebApp)&quot; as user #a3d977
entity &quot;**Wire Server**&quot; as wireserver #99d2f2
entity &quot;**Identity Provider**\n(IdP)&quot; as idp #ffdf71

user -&gt; wireserver : User starts authentication in Wire
wireserver -&gt; user: HTTP POST to IdP w/auth request
user -&gt; idp : (HTML FORM redirect in browser)
note right: Auth request is passed, verified

idp --&gt; idp: end user is sent to login page at IdP \n user logs in, or browser sends cookie

...


idp -&gt; user: Redirect to Wire w/ SAML token
note right: SAML token is generated
user -&gt; wireserver: (HTML FORM redirect in browser)
wireserver -&gt; user: User is logged into Wire

&#64;enduml"/>
</p>
<p>Here is a critique of XML/DSig security (which SAML relies on): <a class="reference external" href="https://www.cs.auckland.ac.nz/~pgut001/pubs/xmlsec.txt">https://www.cs.auckland.ac.nz/~pgut001/pubs/xmlsec.txt</a></p>
</section>
<section id="terminology-and-concepts">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Terminology and concepts</a><a class="headerlink" href="#terminology-and-concepts" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Transport:
The browser carrries out all the redirections from the SP to the IdP and vice versa.</p></li>
<li><p>Service Provider (SP): The entity (here Wire software) that provides its protected resource when an end user tries to access this resource. To accomplish the SAML based SSO authentication, the Service Provider
must have the Identity Provider’s metadata.</p></li>
<li><p>Identity Provider (IdP): Defines the entity that provides the user identities, including the ability to authenticate a user to get access to a protected resource / application from a Service Provider. To accomplish
the SAML based SSO authentication, the IdP must have the Service Provider’s metadata.</p></li>
<li><p>SAML Request: This is the authentication request generated by the Service Provider to request an authentication from the Identity Provider for verifying the user’s identity.</p></li>
<li><p>SAML Response: The SAML Response contains the cryptographically signed assertion of the authenticated user and is generated by the Identity Provider.</p></li>
</ul>
<p>(Definitons adapted from <a class="reference external" href="http://help.collab.net/index.jsp?topic=/teamforge178/action/saml.html">collab.net</a>)</p>
</section>
<section id="setting-up-sso-externally">
<span id="id3"></span><h3><a class="toc-backref" href="#id13" role="doc-backlink">Setting up SSO externally</a><a class="headerlink" href="#setting-up-sso-externally" title="Permalink to this heading"></a></h3>
<p>To set up <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> for a given Wire installation, the Team owner/administrator must enable it.</p>
<p>The first step is to configure the Identity Provider: you’ll need to register Wire as a service provider in your Identity Provider.</p>
<p>We’ve put together guides for registering with different providers:</p>
<ul class="simple">
<li><p>Instructions for <a class="reference internal" href="../okta/main.html#sso-int-with-okta"><span class="std std-ref">Okta</span></a></p></li>
<li><p>Instructions for <a class="reference internal" href="../centrify/main.html"><span class="doc">Centrify</span></a></p></li>
<li><p>Instructions for <a class="reference internal" href="../azure/main.html"><span class="doc">Azure</span></a></p></li>
<li><p>Some screenshots for <a class="reference internal" href="../adfs/main.html"><span class="doc">ADFS</span></a></p></li>
<li><p><a class="reference internal" href="../generic-setup.html"><span class="doc">Generic instructions (try this if none of the above are applicable)</span></a></p></li>
</ul>
<p>As you do this, make sure you take note of your <a class="reference internal" href="#term-IdP"><span class="xref std std-term">IdP</span></a> metadata, which you will need for the next step.</p>
<p>Once you are finished with registering Wire to your <a class="reference internal" href="#term-IdP"><span class="xref std std-term">IdP</span></a>, move on to the next step, setting up <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> internally.</p>
</section>
<section id="setting-up-sso-internally">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Setting up SSO internally</a><a class="headerlink" href="#setting-up-sso-internally" title="Permalink to this heading"></a></h3>
<p>Now that you’ve registered Wire with your identity provider (<a class="reference internal" href="#term-IdP"><span class="xref std std-term">IdP</span></a>), you can enable <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> for your team on Wire.</p>
<p>On Desktop:</p>
<ul class="simple">
<li><p>Click Settings and click “Manage Team”; or go directly to teams.wire.com, or if you have an on-premise install, go to teams.&lt;your-domain&gt;.com</p></li>
<li><p>Login with your account credentials.</p></li>
<li><p>Click “Customization”. Here you will see the section for <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a>.</p></li>
<li><p>Click the blue down arrow.</p></li>
<li><p>Click “Add <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a> Connection”.</p></li>
<li><p>Provide the <a class="reference internal" href="#term-IdP"><span class="xref std std-term">IdP</span></a> metadata. To find out more about retrieving this for your provider, see the guides in the “Setting up <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> externally” step just above.</p></li>
<li><p>Click “Save”.</p></li>
<li><p>Wire will now validate the document to set up the <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a> connection.</p></li>
<li><p>If the data is valid, you will return to the Settings page.</p></li>
<li><p>The page shows the information you need to log in with <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a>. Copy the login code or URL and send it to your team members or partners. For more information see: Logging in with <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a>.</p></li>
</ul>
<p>What to expect after <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> is enabled:</p>
<p>Anyone with a login through your <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a> identity provider (<a class="reference internal" href="#term-IdP"><span class="xref std std-term">IdP</span></a>) and with access to the Wire app will be able to register and log in to your team using the <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> Login URL and/or Code.</p>
<p>Take care to share the code only with members of your team.</p>
<p>If you haven’t set up <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> (<a class="reference internal" href="#introduction">we recommend you do</a>), your team members can create accounts on Wire using <a class="reference internal" href="#term-SSO"><span class="xref std std-term">SSO</span></a> simply by logging in, and will appear on the People tab of the team management page.</p>
<p>If team members already have Wire accounts, use <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> to associate them with the <a class="reference internal" href="#term-SAML"><span class="xref std std-term">SAML</span></a> credentials.  If you make a mistake here, you may end up with several accounts for the same person.</p>
</section>
</section>
<section id="user-provisioning-scim-ldap">
<span id="id4"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink">User provisioning (SCIM/LDAP)</a><a class="headerlink" href="#user-provisioning-scim-ldap" title="Permalink to this heading"></a></h2>
<p>SCIM/LDAP is about <code class="docutils literal notranslate"><span class="pre">provisioning</span></code> (create, update, remove user accounts), not <code class="docutils literal notranslate"><span class="pre">authentication</span></code>.  To learn more about the latter, continue <a class="reference internal" href="#saml-sso"><span class="std std-ref">above</span></a>.</p>
<p>Wire supports the <a class="reference external" href="http://www.simplecloud.info/">SCIM</a> (<a class="reference external" href="https://tools.ietf.org/html/rfc7643">RFC 7643</a>) protocol to create, update and delete users.</p>
<p>If your user data is stored in an LDAP data source like Active Directory or OpenLDAP, you can use our docker-base <a class="reference external" href="https://github.com/wireapp/ldap-scim-bridge/#use-via-docker">ldap-scim-bridge</a> to connect it to wire.</p>
<p>Note that connecting a SCIM client to Wire also disables the functionality to create new users in the SSO login process. This functionality is disabled when a token is created (see below) and re-enabled when all tokens have been deleted.</p>
<p>To set up the connection of your SCIM client (e.g. Azure Active Directory) you need to provide</p>
<ol class="arabic simple">
<li><p>The URL under which Wire’s SCIM API is hosted: <code class="docutils literal notranslate"><span class="pre">https://prod-nginz-https.wire.com/scim/v2</span></code>.
If you are hosting your own instance of Wire then the URL is <code class="docutils literal notranslate"><span class="pre">https://&lt;hostname&gt;/scim/v2</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;hostname&gt;</span></code> is where you are serving Wire’s public endpoints. Some SCIM clients append <code class="docutils literal notranslate"><span class="pre">/v2</span></code> to the URL your provide. If this happens (check the URL mentioned in error messages of your SCIM client) then please provide the URL without the <code class="docutils literal notranslate"><span class="pre">/v2</span></code> suffix, i.e. <code class="docutils literal notranslate"><span class="pre">https://prod-nginz-https.wire.com/scim</span></code> or <code class="docutils literal notranslate"><span class="pre">https://&lt;hostname&gt;/scim</span></code>.</p></li>
<li><p>A secret token which authorizes the use of the SCIM API. Use the  <a class="reference external" href="https://raw.githubusercontent.com/wireapp/wire-server/654b62e3be74d9dddae479178990ebbd4bc77b1e/docs/reference/provisioning/wire_scim_token.py">wire_scim_token.py</a>
script to generate a token. To run the script you need access to an user account with “admin” privileges that can login via email and password. Note that the token is independent from  the admin account that created it, i.e. the token remains valid if the admin account gets deleted or changed.</p></li>
</ol>
<p>You need to configure your SCIM client to use the following mandatory SCIM attributes:</p>
<ol class="arabic simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">userName</span></code> attribute to the desired user handle (the handle is shown
with an &#64; prefix in apps). It must be unique accross the entire Wire Cloud
(or unique on your own instance), and consist of the characters <code class="docutils literal notranslate"><span class="pre">a-z0-9_.-</span></code>
(no capital letters).</p></li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">displayName</span></code> attribute to the user’s desired display name, e.g. “Jane Doe”.
It must consist of 1-128 unicode characters. It does not need to be unique.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">externalId</span></code> attribute:</p>
<ol class="arabic simple">
<li><p>If you are using Wire’s SAML SSO feature then set <code class="docutils literal notranslate"><span class="pre">externalId</span></code> attribute to the same identifier used for <code class="docutils literal notranslate"><span class="pre">NameID</span></code> in your SAML configuration.</p></li>
<li><p>If you are using email/password authentication then set the <code class="docutils literal notranslate"><span class="pre">externalId</span></code>
attribute to the user’s email address. The user will receive an invitation email during provisioning. Also note that the account will be set to <code class="docutils literal notranslate"><span class="pre">&quot;active&quot;:</span> <span class="pre">false</span></code> until the user has accepted the invitation and activated the account.</p></li>
</ol>
</li>
</ol>
<p>You can optionally make use of Wire’s <code class="docutils literal notranslate"><span class="pre">urn:wire:scim:schemas:profile:1.0</span></code> extension field to store arbitrary user profile data that is shown in the users profile, e.g. department, role. See <a class="reference external" href="https://github.com/wireapp/wire-server/blob/develop/docs/reference/user/rich-info.md#scim-support-refrichinfoscim">docs</a> for details.</p>
<section id="scim-management-in-wire-in-team-management">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">SCIM management in Wire (in Team Management)</a><a class="headerlink" href="#scim-management-in-wire-in-team-management" title="Permalink to this heading"></a></h3>
<section id="scim-security-and-authentication">
<h4><a class="toc-backref" href="#id17" role="doc-backlink">SCIM security and authentication</a><a class="headerlink" href="#scim-security-and-authentication" title="Permalink to this heading"></a></h4>
<p>Wire uses a very basic variant of oauth, where a <em>bearer token</em> is presented to the server in header with all <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> requests.</p>
<p>You can create such bearer tokens in team management and copy them from there into your the dashboard of your SCIM data source.</p>
</section>
<section id="generating-a-scim-token">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Generating a SCIM token</a><a class="headerlink" href="#generating-a-scim-token" title="Permalink to this heading"></a></h4>
<p>In order to be able to send SCIM requests to Wire, we first need to generate a SCIM token. This section explains how to do this.</p>
<p>Once the token is generated, it should be noted/remembered, and it will be used in all subsequent SCIM uses/requests to authenticate the request as valid/authenticated.</p>
<p>These are the steps to generate a new <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> token, which you will need to provide to your identity provider (<a class="reference internal" href="#term-IdP"><span class="xref std std-term">IdP</span></a>), along with the target API URL, to enable <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> provisionning.</p>
<ul class="simple">
<li><p>Step 1: Go to <a class="reference external" href="https://teams.wire.com/settings">https://teams.wire.com/settings</a> (Here replace “wire.com” with your own domain if you have an on-premise installation of Wire).</p></li>
</ul>
<img alt="../../../_images/token-step-01.png" class="align-center" src="../../../_images/token-step-01.png" />
<ul class="simple">
<li><p>Step 2: In the left menu, go to “Customization”.</p></li>
</ul>
<img alt="../../../_images/token-step-02.png" class="align-center" src="../../../_images/token-step-02.png" />
<ul class="simple">
<li><p>Step 3: Go to “Automated User Management (<a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a>)” and click the “down” to expand</p></li>
</ul>
<img alt="../../../_images/token-step-03.png" class="align-center" src="../../../_images/token-step-03.png" />
<ul class="simple">
<li><p>Step 4: Click “Generate token”, if your password is requested, enter it.</p></li>
</ul>
<img alt="../../../_images/token-step-04.png" class="align-center" src="../../../_images/token-step-04.png" />
<ul class="simple">
<li><p>Step 5: Once the token is generated, copy it into your clipboard and store it somewhere safe (eg., in the dashboard of your SCIM data source).</p></li>
</ul>
<img alt="../../../_images/token-step-05.png" class="align-center" src="../../../_images/token-step-05.png" />
<ul class="simple">
<li><p>Step 6: You’re done!  You can now view token information, delete the token, or create more tokens should you need them.</p></li>
</ul>
<img alt="../../../_images/token-step-06.png" class="align-center" src="../../../_images/token-step-06.png" />
<p>Tokens are now listed in this <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a>-related area of the screen, you can generate up to 8 such tokens.</p>
</section>
</section>
<section id="using-scim-via-curl">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Using SCIM via Curl</a><a class="headerlink" href="#using-scim-via-curl" title="Permalink to this heading"></a></h3>
<p>You can use the <a class="reference internal" href="#term-Curl"><span class="xref std std-term">Curl</span></a> command line HTTP tool to access the wire backend (in particular the <code class="docutils literal notranslate"><span class="pre">spar</span></code> service) through the <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> API.</p>
<p>This can be helpful to write your own tooling to interface with wire.</p>
<section id="creating-a-scim-token">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">Creating a SCIM token</a><a class="headerlink" href="#creating-a-scim-token" title="Permalink to this heading"></a></h4>
<p>Before we can send commands to the <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> API/Spar service, we need to be authenticated. This is done through the creation of a <a class="reference internal" href="#term-SCIM"><span class="xref std std-term">SCIM</span></a> token.</p>
<p>First, we need a little shell environment. Run the following in your terminal/shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_BACKEND</span><span class="o">=</span>https://prod-nginz-https.wire.com
<span class="linenos">2</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_ADMIN</span><span class="o">=</span>...
<span class="linenos">3</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">WIRE_PASSWD</span><span class="o">=</span>...
</pre></div>
</div>
<p>Wire’s SCIM API currently supports a variant of HTTP basic auth.</p>
<p>In order to create a token in your team, you need to authenticate using your team admin credentials.</p>
<p>The way this works behind the scenes in your browser or cell phone, and in plain sight if you want to use curl, is you need to get a Wire token.</p>
<p>First install the <code class="docutils literal notranslate"><span class="pre">jq</span></code> command (<a class="reference external" href="https://stedolan.github.io/jq/">https://stedolan.github.io/jq/</a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>jq
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you don’t want to install <code class="docutils literal notranslate"><span class="pre">jq</span></code>, you can just call the <code class="docutils literal notranslate"><span class="pre">curl</span></code> command and copy the access token into the shell variable manually.</p>
</div>
<p>Then run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">export</span><span class="w"> </span><span class="nv">BEARER</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">3</span>--header<span class="w"> </span><span class="s1">&#39;Accept: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">4</span>-d<span class="w"> </span><span class="s1">&#39;{&quot;email&quot;:&quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$WIRE_ADMIN</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,&quot;password&quot;:&quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$WIRE_PASSWD</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">5</span><span class="nv">$WIRE_BACKEND</span>/login<span class="s1">&#39;?persist=false&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.access_token<span class="k">)</span>
</pre></div>
</div>
<p>This token will be good for 15 minutes; after that, just repeat the command above to get a new token.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SCIM requests are authenticated with a SCIM token, see below. SCIM tokens and Wire tokens are different things.</p>
<p>A Wire token is necessary to get a SCIM token. SCIM tokens do not expire, but need to be deleted explicitly.</p>
</div>
<p>You can test that you are logged in with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">$WIRE_BACKEND</span>/self
</pre></div>
</div>
<p>Now you are ready to create a SCIM token:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">export</span><span class="w"> </span><span class="nv">SCIM_TOKEN_FULL</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">3</span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json;charset=utf-8&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">4</span>-d<span class="w"> </span><span class="s1">&#39;{ &quot;description&quot;: &quot;test &#39;</span><span class="s2">&quot;`date`&quot;</span><span class="s1">&#39;&quot;, &quot;password&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$WIRE_PASSWD</span><span class="s2">&quot;</span><span class="s1">&#39;&quot; }&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">5</span><span class="nv">$WIRE_BACKEND</span>/scim/auth-tokens<span class="k">)</span>
<span class="linenos">6</span><span class="nb">export</span><span class="w"> </span><span class="nv">SCIM_TOKEN</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$SCIM_TOKEN_FULL</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.token<span class="k">)</span>
<span class="linenos">7</span><span class="nb">export</span><span class="w"> </span><span class="nv">SCIM_TOKEN_ID</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$SCIM_TOKEN_FULL</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.info.id<span class="k">)</span>
</pre></div>
</div>
<p>The SCIM token is now contained in the <code class="docutils literal notranslate"><span class="pre">SCIM_TOKEN</span></code> environment variable.</p>
<p>EXPERT HINT: If you are a site operator and have the ok from the team admin, but not their password, you can try something like this (WARNING!  TEST THIS ON NON-PROD ACCOUNTS FIRST!):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;$(uuid -v4)&quot;</span>
<span class="n">export</span> <span class="n">token_</span><span class="o">=</span><span class="s2">&quot;$(dd if=/dev/random bs=32 count=1 | base64)&quot;</span>
<span class="n">export</span> <span class="n">created_at</span><span class="o">=</span><span class="s1">&#39;2023-05-30 11:15:00+0000&#39;</span>
<span class="n">export</span> <span class="n">team</span><span class="o">=...</span>
<span class="n">export</span> <span class="n">descr</span><span class="o">=...</span>
<span class="n">echo</span> <span class="s1">&#39;INSERT INTO spar.team_provisioning_by_token (token_, team, id, created_at, idp, descr) VALUES (&#39;</span>\<span class="s1">&#39;$token_</span><span class="se">\&#39;</span><span class="s1">, $team, $id, </span><span class="se">\&#39;</span><span class="s1">$created_at</span><span class="se">\&#39;</span><span class="s1">, NULL, </span><span class="se">\&#39;</span><span class="s1">$descr</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">);</span><span class="s1">&#39;</span>
<span class="n">echo</span> <span class="s1">&#39;INSERT INTO spar.team_provisioning_by_team (token_, team, id, created_at, idp, descr) VALUES (&#39;</span>\<span class="s1">&#39;$token_</span><span class="se">\&#39;</span><span class="s1">, $team, $id, </span><span class="se">\&#39;</span><span class="s1">$created_at</span><span class="se">\&#39;</span><span class="s1">, NULL, </span><span class="se">\&#39;</span><span class="s1">$descr</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">);</span><span class="s1">&#39;</span>
<span class="n">echo</span> <span class="s1">&#39;SELECT * FROM spar.team_provisioning_by_team WHERE &#39;</span><span class="s2">&quot;team = $team AND id = $id;&quot;</span>
<span class="n">echo</span> <span class="s1">&#39;SELECT * FROM spar.team_provisioning_by_token WHERE &#39;</span><span class="s2">&quot;token_ = $token_;&quot;</span>
<span class="n">echo</span> <span class="s1">&#39;DELETE FROM spar.team_provisioning_by_team WHERE &#39;</span><span class="s2">&quot;team = $team AND id = $id;&quot;</span>
<span class="n">echo</span> <span class="s1">&#39;DELETE FROM spar.team_provisioning_by_token WHERE &#39;</span><span class="s2">&quot;token_ = $token_;&quot;</span>
</pre></div>
</div>
<p>You can look it up again with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span><span class="nv">$WIRE_BACKEND</span>/scim/auth-tokens
</pre></div>
</div>
<p>And you can delete it with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$BEARER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span><span class="nv">$WIRE_BACKEND</span>/scim/auth-tokens?id<span class="o">=</span><span class="nv">$SCIM_TOKEN_ID</span>
</pre></div>
</div>
</section>
<section id="using-a-scim-token-to-create-read-update-and-delete-crud-users">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">Using a SCIM token to Create Read Update and Delete (CRUD) users</a><a class="headerlink" href="#using-a-scim-token-to-create-read-update-and-delete-crud-users" title="Permalink to this heading"></a></h4>
<p>Now that you have your SCIM token, you can use it to talk to the SCIM API to manipulate (create, read, update, delete) users, either individually or in bulk.</p>
<p><strong>JSON encoding of SCIM Users</strong></p>
<p>In order to manipulate users using commands, you need to specify user data.</p>
<p>A minimal definition of a user is written in JSON format and looks like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">{</span>
<span class="linenos">2</span><span class="w">   </span><span class="nt">&quot;schemas&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;</span><span class="p">],</span>
<span class="linenos">3</span><span class="w">   </span><span class="nt">&quot;externalId&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nick@example.com&quot;</span><span class="p">,</span>
<span class="linenos">4</span><span class="w">   </span><span class="nt">&quot;userName&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nick&quot;</span><span class="p">,</span>
<span class="linenos">5</span><span class="w">   </span><span class="nt">&quot;displayName&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The Nick&quot;</span>
<span class="linenos">6</span><span class="p">}</span>
</pre></div>
</div>
<p>You can store it in a variable using this sort of command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">export</span><span class="w"> </span><span class="nv">SCIM_USER</span><span class="o">=</span><span class="s1">&#39;{</span>
<span class="linenos">2</span><span class="s1">   &quot;schemas&quot;     : [&quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;],</span>
<span class="linenos">3</span><span class="s1">   &quot;externalId&quot;  : &quot;nick@example.com&quot;,</span>
<span class="linenos">4</span><span class="s1">   &quot;userName&quot;    : &quot;nick&quot;,</span>
<span class="linenos">5</span><span class="s1">   &quot;displayName&quot; : &quot;The Nick&quot;</span>
<span class="linenos">6</span><span class="s1">}&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">externalId</span></code> is used to construct a SAML identity.  Two cases are
currently supported:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">externalId</span></code> contains a valid email address.
The SAML <code class="docutils literal notranslate"><span class="pre">NameID</span></code> has the form <code class="docutils literal notranslate"><span class="pre">&lt;NameID</span> <span class="pre">Format=&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&quot;&gt;me&#64;example.com&lt;/NameID&gt;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">externalId</span></code> contains anything that is <em>not</em> an email address.
The SAML <code class="docutils literal notranslate"><span class="pre">NameID</span></code> has the form <code class="docutils literal notranslate"><span class="pre">&lt;NameID</span> <span class="pre">Format=&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&quot;&gt;...&lt;/NameID&gt;</span></code>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important to configure your SAML provider to use <code class="docutils literal notranslate"><span class="pre">nameid-format:emailAddress</span></code> or <code class="docutils literal notranslate"><span class="pre">nameid-format:unspecified</span></code>.  Other nameid formats are not supported at this moment.</p>
<p>See <a class="reference external" href="https://docs.wire.com/how-to/single-sign-on/trouble-shooting.html#how-should-i-map-user-data-to-scim-attributes-when-provisioning-users-via-scim">FAQ</a></p>
</div>
<p>We also support custom fields that are used in rich profiles in this form (see: <a class="reference external" href="https://github.com/wireapp/wire-server/blob/develop/docs/reference/user/rich-info.md">https://github.com/wireapp/wire-server/blob/develop/docs/reference/user/rich-info.md</a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">SCIM_USER</span><span class="o">=</span><span class="s1">&#39;{</span>
<span class="linenos"> 2</span><span class="s1">   &quot;schemas&quot;     : [&quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;, &quot;urn:wire:scim:schemas:profile:1.0&quot;],</span>
<span class="linenos"> 3</span><span class="s1">   &quot;externalId&quot;  : &quot;rnick@example.com&quot;,</span>
<span class="linenos"> 4</span><span class="s1">   &quot;userName&quot;    : &quot;rnick&quot;,</span>
<span class="linenos"> 5</span><span class="s1">   &quot;displayName&quot; : &quot;The Rich Nick&quot;,</span>
<span class="linenos"> 6</span><span class="s1">   &quot;urn:wire:scim:schemas:profile:1.0&quot;: {</span>
<span class="linenos"> 7</span><span class="s1">      &quot;richInfo&quot;: [</span>
<span class="linenos"> 8</span><span class="s1">         {</span>
<span class="linenos"> 9</span><span class="s1">         &quot;type&quot;: &quot;Department&quot;,</span>
<span class="linenos">10</span><span class="s1">         &quot;value&quot;: &quot;Sales &amp; Marketing&quot;</span>
<span class="linenos">11</span><span class="s1">         },</span>
<span class="linenos">12</span><span class="s1">         {</span>
<span class="linenos">13</span><span class="s1">         &quot;type&quot;: &quot;Favorite color&quot;,</span>
<span class="linenos">14</span><span class="s1">         &quot;value&quot;: &quot;Blue&quot;</span>
<span class="linenos">15</span><span class="s1">         }</span>
<span class="linenos">16</span><span class="s1">      ]</span>
<span class="linenos">17</span><span class="s1">   }</span>
<span class="linenos">18</span><span class="s1"> }&#39;</span>
</pre></div>
</div>
<p><strong>How to create a user</strong></p>
<p>You can create a user using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">STORED_USER</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span><span class="w">  </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$SCIM_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">3</span><span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json;charset=utf-8&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">4</span><span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCIM_USER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">5</span><span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/scim/v2/Users<span class="k">)</span>
<span class="linenos">6</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">STORED_USER_ID</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$STORED_USER</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.id<span class="k">)</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">$SCIM_USER</span></code> is in the JSON format and is declared before running this commend as described in the section above.</p>
<p><strong>Get a specific user</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span><span class="w">   </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$SCIM_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">3</span><span class="w">   </span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json;charset=utf-8&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">4</span><span class="w">   </span><span class="nv">$WIRE_BACKEND</span>/scim/v2/Users/<span class="nv">$STORED_USER_ID</span>
</pre></div>
</div>
<p><strong>Search a specific user</strong></p>
<p>SCIM user search is quite flexible.  Wire currently only supports lookup by wire handle or email address.</p>
<p>Email address (and/or SAML NameID, if /a):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span><span class="w">   </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$SCIM_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">3</span><span class="w">   </span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json;charset=utf-8&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">4</span><span class="w">   </span><span class="nv">$WIRE_BACKEND</span>/scim/v2/Users/<span class="s1">&#39;?filter=externalId%20eq%20%22me%40example.com%22&#39;</span>
</pre></div>
</div>
<p>Wire handle: same request, just replace the query part with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;?filter=userName%20eq%20%22me%22&#39;</span>
</pre></div>
</div>
<p><strong>Update a specific user</strong></p>
<p>For each put request, you need to provide the full json object.  All omitted fields will be set to <code class="docutils literal notranslate"><span class="pre">null</span></code>.  (If you do not have an up-to-date user present, just <code class="docutils literal notranslate"><span class="pre">GET</span></code> one right before the <code class="docutils literal notranslate"><span class="pre">PUT</span></code>.)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">SCIM_USER</span><span class="o">=</span><span class="s1">&#39;{</span>
<span class="linenos">2</span><span class="s1">   &quot;schemas&quot;     : [&quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;],</span>
<span class="linenos">3</span><span class="s1">   &quot;externalId&quot;  : &quot;rnick@example.com&quot;,</span>
<span class="linenos">4</span><span class="s1">   &quot;userName&quot;    : &quot;newnick&quot;,</span>
<span class="linenos">5</span><span class="s1">   &quot;displayName&quot; : &quot;The New Nick&quot;</span>
<span class="linenos">6</span><span class="s1"> }&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span><span class="w">  </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$SCIM_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">3</span><span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json;charset=utf-8&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">4</span><span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCIM_USER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">5</span><span class="w">  </span><span class="nv">$WIRE_BACKEND</span>/scim/v2/Users/<span class="nv">$STORED_USER_ID</span>
</pre></div>
</div>
<p><strong>Deactivate user</strong></p>
<p>It is possible to temporarily deactivate an user (and reactivate him later) by setting his <code class="docutils literal notranslate"><span class="pre">active</span></code> property to <code class="docutils literal notranslate"><span class="pre">true/false</span></code> without affecting his device history.  (<code class="docutils literal notranslate"><span class="pre">active=false</span></code> changes the wire user status to <code class="docutils literal notranslate"><span class="pre">suspended</span></code>.)</p>
<p><strong>Delete user</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span><span class="se">\</span>
<span class="linenos">2</span><span class="w">   </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$SCIM_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">3</span><span class="w">   </span><span class="nv">$WIRE_BACKEND</span>/scim/v2/Users/<span class="nv">$STORED_USER_ID</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Single Sign-On and User Provisioning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../trouble-shooting.html" class="btn btn-neutral float-right" title="Trouble shooting &amp; FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 - 2023, Wire Swiss GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>