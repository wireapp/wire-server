<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installing centralized logging dashboards using Kibana &mdash; Wire 0.0.4 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/wire.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Ingress traffic to wire-server (ingress-nginx-controller)" href="ingress.html" />
    <link rel="prev" title="Monitoring wire-server using Prometheus and Grafana" href="monitoring.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href="../../index.html">
        <img src="../../_static/Wire_logo.svg" class="logo" alt="Logo"/>
    </a>

    <!--
            <div class="version">
                0.0.4
            </div> -->
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../security-responses/index.html">Security responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Installation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="planning.html">How to plan an installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="version-requirements.html">Version requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="dependencies.html">Dependencies on operator’s machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">How to install kubernetes (Demo)</a></li>
<li class="toctree-l2"><a class="reference internal" href="helm.html">How to install wire-server using Helm (Demo)</a></li>
<li class="toctree-l2"><a class="reference internal" href="prod-intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-VMs.html">How to install kubernetes and databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws-prod.html">How to configure AWS services</a></li>
<li class="toctree-l2"><a class="reference internal" href="helm-prod.html">How to install wire-server using Helm</a></li>
<li class="toctree-l2"><a class="reference internal" href="infrastructure-configuration.html">Infrastructure configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">How to monitor wire-server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to see centralized logs for wire-server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-required-helm-charts">Installing required helm charts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#deploying-elasticsearch">Deploying Elasticsearch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deploying-elasticsearch-curator">Deploying Elasticsearch-Curator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deploying-kibana">Deploying Kibana</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deploying-fluent-bit">Deploying fluent-bit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-fluent-bit">Configuring fluent-bit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#post-install-kibana-setup">Post-install kibana setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-after-installation">Usage after installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nuking-it-all">Nuking it all.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging">Debugging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-this-was-developed">How this was developed</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ingress.html">Ingress-controller (getting traffic in)</a></li>
<li class="toctree-l2"><a class="reference internal" href="web-app-settings.html">Web app settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="sft.html">Installing Conference Calling 2.0 (aka SFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="restund.html">Installing Restund</a></li>
<li class="toctree-l2"><a class="reference internal" href="tls.html">Configure TLS ciphers</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-authentication.html">Managing authentication with ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-tinc.html">Using tinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting during installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="post-install.html">Verifying your installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../administrate/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../understand/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developers Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Wire</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Installation</a></li>
      <li class="breadcrumb-item active">Installing centralized logging dashboards using Kibana</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/wireapp/wire-server/blob/develop/docs/src/how-to/install/logging.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installing-centralized-logging-dashboards-using-kibana">
<span id="logging"></span><h1>Installing centralized logging dashboards using Kibana<a class="headerlink" href="#installing-centralized-logging-dashboards-using-kibana" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This page shows you how to install Elasticsearch, Kibana, and fluent-bit to aggregate and visualize the logs from wire-server components.</p>
</section>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this heading"></a></h2>
<p>Logging support is in active development as of September 2019, some logs may not be visible yet, and certain parts are not fully automated yet.</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<p>You need to have wire-server installed, see either of</p>
<ul class="simple">
<li><p><a class="reference internal" href="helm.html#helm"><span class="std std-ref">Installing wire-server (demo) components using helm</span></a></p></li>
<li><p><a class="reference internal" href="helm-prod.html#helm-prod"><span class="std std-ref">Installing wire-server (production) components using Helm</span></a>.</p></li>
</ul>
</section>
<section id="installing-required-helm-charts">
<h2>Installing required helm charts<a class="headerlink" href="#installing-required-helm-charts" title="Permalink to this heading"></a></h2>
<section id="deploying-elasticsearch">
<h3>Deploying Elasticsearch<a class="headerlink" href="#deploying-elasticsearch" title="Permalink to this heading"></a></h3>
<p>Elasticsearch indexes the logs and makes them searchable. The following elasticsearch-ephemeral chart makes use of the disk space the pod happens to run on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ helm install --namespace &lt;namespace&gt; wire/elasticsearch-ephemeral
</pre></div>
</div>
<p>Note that since we are not specifying a release name during helm
install, it generates a ‘verb-noun’ pair, and uses it. Elasticsearch’s
chart does not use the release name of the helm chart in the pod name,
sadly.</p>
</section>
<section id="deploying-elasticsearch-curator">
<h3>Deploying Elasticsearch-Curator<a class="headerlink" href="#deploying-elasticsearch-curator" title="Permalink to this heading"></a></h3>
<p>Elasticsearch-curator trims the logs that are contained in elasticsearch, so
that your elasticsearch pod does not get too large, crash, and need to be
re-built.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ helm install --namespace &lt;namespace&gt; wire/elasticsearch-curator
</pre></div>
</div>
<p>Note that since we are not specifying a release name during helm
install, it generates a ‘verb-noun’ pair, and uses it. If you look at
your pod names, you can see this name prepended to your pods in ‘kubectl
-n get pods’.</p>
</section>
<section id="deploying-kibana">
<h3>Deploying Kibana<a class="headerlink" href="#deploying-kibana" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ helm install --namespace &lt;namespace&gt; wire/kibana
</pre></div>
</div>
<p>Note that since we are not specifying a release name during helm
install, it generates a ‘verb-noun’ pair, and uses it. If you look at
your pod names, you can see this name prepended to your pods in ‘kubectl
-n get pods’.</p>
</section>
<section id="deploying-fluent-bit">
<h3>Deploying fluent-bit<a class="headerlink" href="#deploying-fluent-bit" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ helm install --namespace &lt;namespace&gt; wire/fluent-bit
</pre></div>
</div>
</section>
</section>
<section id="configuring-fluent-bit">
<h2>Configuring fluent-bit<a class="headerlink" href="#configuring-fluent-bit" title="Permalink to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following makes use of overrides for helm charts. You may wish to read <a class="reference internal" href="../../understand/helm.html#understand-helm-overrides"><span class="std std-ref">Overriding helm configuration settings</span></a> first.</p>
</div>
<p>Per pod-template, you can specify what parsers <code class="docutils literal notranslate"><span class="pre">fluent-bit</span></code> needs to
use to interpret the pod’s logs in a structured way. By default, it just
parses them as plain text. But, you can change this using a pod
annotation. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Pod</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">brig</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">brig</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">fluentbit</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">parser</span><span class="p">:</span> <span class="n">json</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">containers</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">apache</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">edsiper</span><span class="o">/</span><span class="n">apache_logs</span>
</pre></div>
</div>
<p>You can also define your own custom parsers in our <code class="docutils literal notranslate"><span class="pre">fluent-bit</span></code>
chart’s <code class="docutils literal notranslate"><span class="pre">values.yml</span></code>. For example, we have one defined for <code class="docutils literal notranslate"><span class="pre">nginz</span></code>.
For more info, see :
<a class="reference external" href="https://github.com/fluent/fluent-bit-docs/blob/master/filter/kubernetes.md#kubernetes-annotations">https://github.com/fluent/fluent-bit-docs/blob/master/filter/kubernetes.md#kubernetes-annotations</a></p>
<p>Alternately, if there is already fluent-bit deployed in your
environment, get the helm name for the deployment (verb-noun prepended
to the pod name), and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ helm upgrade &lt;helm-name&gt; --namespace &lt;namespace&gt; wire/fluent-bit
</pre></div>
</div>
<p>Note that since we are not specifying a release name during helm
install, it generates a ‘verb-noun’ pair, and uses it. if you look at
your pod names, you can see this name prepended to your pods in ‘kubectl
-n get pods’.</p>
</section>
<section id="post-install-kibana-setup">
<span id="id1"></span><h2>Post-install kibana setup<a class="headerlink" href="#post-install-kibana-setup" title="Permalink to this heading"></a></h2>
<p>Get the pod name for your kibana instance (not the one set up with
fluent-bit), and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl -n &lt;namespace&gt; port-forward &lt;pod_name&gt; 5601:5601
</pre></div>
</div>
<p>go to 127.0.0.1:5601 in your web browser.</p>
<ol class="arabic simple">
<li><p>Click on ‘discover’.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">kubernetes_cluster-*</span></code> as the Index pattern.</p></li>
<li><p>Click on ‘Next step’</p></li>
<li><p>Click on the ‘Time Filter field name’ dropdown, and select
<a class="reference external" href="mailto:'&#37;&#52;&#48;timestamp">mailto:’<span>&#64;</span>timestamp</a>’.</p></li>
<li><p>Click on ‘create index patern’.</p></li>
</ol>
</section>
<section id="usage-after-installation">
<h2>Usage after installation<a class="headerlink" href="#usage-after-installation" title="Permalink to this heading"></a></h2>
<p>Get the pod name for your kibana instance (not the one set up with
fluent-bit), and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl -n &lt;namespace&gt; port-forward &lt;pod_name&gt; 5601:5601
</pre></div>
</div>
<p>Go to 127.0.0.1:5601 in your web browser.</p>
<p>Click on ‘discover’ to view data.</p>
</section>
<section id="nuking-it-all">
<span id="id2"></span><h2>Nuking it all.<a class="headerlink" href="#nuking-it-all" title="Permalink to this heading"></a></h2>
<p>Find the names of the helm releases for your pods (look at <code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">ls</span> <span class="pre">--all</span></code>
and <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">-n</span> <span class="pre">&lt;namespace&gt;</span> <span class="pre">get</span> <span class="pre">pods</span></code> , and run
<code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">del</span> <span class="pre">&lt;helm_deploy_name&gt;</span> <span class="pre">--purge</span></code> for each of them.</p>
<p>Note: Elasticsearch does not use the name of the helm chart, and
therefore is harder to identify.</p>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">namespace</span><span class="o">&gt;</span> <span class="n">logs</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span>
</pre></div>
</div>
<section id="how-this-was-developed">
<h3>How this was developed<a class="headerlink" href="#how-this-was-developed" title="Permalink to this heading"></a></h3>
<p>First, we deployed elasticsearch with the elasticsearch-ephemeral chart,
then kibana. then we deployed fluent-bit, which set up a kibana of it’s
own that looks broken. It had a kibana .tgz in an incorrect location. It
also set up way more VMs than I thought, AND consumed the logs for the
entire cluster, Rather than for the namespace it’s contained in, as I
expected.</p>
<p>For kibana and fluent-bit, we created a shell of overrides, with a
dependency on the actual chart, so that when we helm dep update, helm
grabs the chart from upstream, instead of bringing the source of the
chart into our repository. There were only three files to modify, which
we copied from the fake-aws-s3 chart and modified: Chart.yaml,
requirements.yaml, and values.yaml.</p>
<p>For elasticsearch, we bumped the version number, because kibana was
refusing to start, citing too old of a version of elasticsearch. it
wants a 6.x, we use 5.x for brig, and for our kibana/logserver setup.
later, we forced integration tests against the new elasticsearch in
confluence.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="monitoring.html" class="btn btn-neutral float-left" title="Monitoring wire-server using Prometheus and Grafana" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ingress.html" class="btn btn-neutral float-right" title="Ingress traffic to wire-server (ingress-nginx-controller)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 - 2023, Wire Swiss GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>