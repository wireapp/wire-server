---
helmDefaults:
  wait: true
  timeout: 600
  devel: true
  createNamespace: true
---
repositories:
  # - name: stable
  #   url: 'https://charts.helm.sh/stable'

  # - name: bitnami
  #   url: 'https://charts.bitnami.com/bitnami'

  # - name: ingress
  #   url: 'https://kubernetes.github.io/ingress-nginx'

  - name: jetstack
    url: 'https://charts.jetstack.io'

  - name: bedag
    url: 'https://bedag.github.io/helm-charts/'

releases:
  - name: 'cert-manager'
    namespace: cert-manager
    chart: jetstack/cert-manager
    set:
      - name: installCRDs
        value: true

  - name: 'federation-certs'
    namespace: cert-manager
    chart: bedag/raw
    values:
      - resources:
        - apiVersion: v1
          kind: Secret
          metadata:
            name: federation-ca
            namespace: cert-manager
          data:
            tls.crt: {{ readFile "../services/nginz/integration-test/conf/nginz/integration-ca.pem" | b64enc | quote }}
            tls.key: {{ readFile "../services/nginz/integration-test/conf/nginz/integration-ca-key.pem" | b64enc | quote }}
        - apiVersion: cert-manager.io/v1
          kind: ClusterIssuer
          metadata:
            name: federation
          spec:
            ca:
              secretName: federation-ca
